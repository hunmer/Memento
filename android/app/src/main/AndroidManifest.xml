<manifest xmlns:android="http://schemas.android.com/apk/res/android">
    <!-- 调试和网络权限 -->
    <uses-permission android:name="android.permission.INTERNET" />
    <uses-permission android:name="android.permission.ACCESS_NETWORK_STATE" />
    <!-- 调试配置 -->
    <uses-permission android:name="android.permission.ACCESS_NETWORK_STATE" />
    <!-- 存储权限 -->
    <uses-permission android:name="android.permission.WRITE_EXTERNAL_STORAGE"/>
    <uses-permission android:name="android.permission.FOREGROUND_SERVICE" />
    <uses-permission android:name="android.permission.FOREGROUND_SERVICE_DATA_SYNC" />
    <uses-permission android:name="android.permission.POST_NOTIFICATIONS" />
    <uses-permission android:name="android.permission.READ_EXTERNAL_STORAGE" android:maxSdkVersion="32" />
    <uses-permission android:name="android.permission.READ_MEDIA_IMAGES" />
    <uses-permission android:name="android.permission.READ_MEDIA_VIDEO" />
    <uses-permission android:name="android.permission.READ_MEDIA_AUDIO" />
    <!-- 录音权限 -->
    <uses-permission android:name="android.permission.RECORD_AUDIO" />
    <!-- 日历权限 -->
    <uses-permission android:name="android.permission.READ_CALENDAR" />
    <uses-permission android:name="android.permission.WRITE_CALENDAR" />
    <!-- 闹钟权限 -->
    <uses-permission android:name="android.permission.SCHEDULE_EXACT_ALARM" />
    <uses-permission android:name="android.permission.USE_EXACT_ALARM" />
    <uses-permission android:name="android.permission.FOREGROUND_SERVICE_REMOTE_MESSAGING" />
    <application
        android:label="Memento"
        android:name="${applicationName}"
        android:icon="@drawable/app_icon"
        android:enableOnBackInvokedCallback="true">
        <!-- 前台服务类型声明 -->
        <meta-data
            android:name="flutterEmbedding"
            android:value="2" />
        <service
            android:name="github.hunmer.memento.TimerForegroundService"
            android:exported="false"
            android:foregroundServiceType="dataSync" />
        <service
            android:name="github.hunmer.memento.ActivityForegroundService"
            android:exported="false"
            android:foregroundServiceType="dataSync" />
        
        <!-- Warning: Do not change service name. -->
        <service 
            android:name="com.pravera.flutter_foreground_task.service.ForegroundService"
            android:foregroundServiceType="dataSync|remoteMessaging"
            android:exported="false" />
        <meta-data
        android:name="github.hunmer.memento.service.APP_ICON"
        android:resource="@drawable/launcher_icon" />
        <activity
            android:name=".MainActivity"
            android:exported="true"
            android:launchMode="singleTop"
            android:taskAffinity=""
            android:theme="@style/LaunchTheme"
            android:configChanges="orientation|keyboardHidden|keyboard|screenSize|smallestScreenSize|locale|layoutDirection|fontScale|screenLayout|density|uiMode"
            android:hardwareAccelerated="true"
            android:windowSoftInputMode="adjustResize">
            <!-- Specifies an Android theme to apply to this Activity as soon as
                 the Android process has started. This theme is visible to the user
                 while the Flutter UI initializes. After that, this theme continues
                 to determine the Window background behind the Flutter UI. -->
            <meta-data
              android:name="io.flutter.embedding.android.NormalTheme"
              android:resource="@style/NormalTheme"
              />
            <intent-filter>
                <action android:name="android.intent.action.MAIN"/>
                <category android:name="android.intent.category.LAUNCHER"/>
            </intent-filter>
            <!-- DeepLink 支持 - 用于桌面小组件跳转 -->
            <intent-filter android:autoVerify="true">
                <action android:name="android.intent.action.VIEW" />
                <category android:name="android.intent.category.DEFAULT" />
                <category android:name="android.intent.category.BROWSABLE" />
                <!-- memento:// scheme -->
                <data
                    android:scheme="memento"
                    android:host="widget" />
            </intent-filter>
        </activity>
        <!-- Don't delete the meta-data below.
             This is used by the Flutter tool to generate GeneratedPluginRegistrant.java -->
        <meta-data
            android:name="flutterEmbedding"
            android:value="2" />

        <!-- FileProvider for flutter_quill image clipboard support -->
        <provider
            android:name="androidx.core.content.FileProvider"
            android:authorities="${applicationId}.fileprovider"
            android:exported="false"
            android:grantUriPermissions="true" >
            <meta-data
                android:name="android.support.FILE_PROVIDER_PATHS"
                android:resource="@xml/file_paths" />
        </provider>

        <!-- 桌面小组件 - 频道快速发送 -->
        <receiver
            android:name=".ChatQuickWidgetProvider"
            android:exported="true">
            <intent-filter>
                <action android:name="android.appwidget.action.APPWIDGET_UPDATE" />
            </intent-filter>
            <meta-data
                android:name="android.appwidget.provider"
                android:resource="@xml/widget_chat_info" />
        </receiver>

        <!-- 桌面小组件 - AI 语音快捷 -->
        <receiver
            android:name=".AgentVoiceWidgetProvider"
            android:exported="true">
            <intent-filter>
                <action android:name="android.appwidget.action.APPWIDGET_UPDATE" />
            </intent-filter>
            <meta-data
                android:name="android.appwidget.provider"
                android:resource="@xml/widget_agent_voice_info" />
        </receiver>

        <!-- ========== 插件小组件 1x1 尺寸 ========== -->

        <!-- 待办事项 1x1 -->
        <receiver
            android:name=".widget.providers.TodoWidgetProvider"
            android:exported="true">
            <intent-filter>
                <action android:name="android.appwidget.action.APPWIDGET_UPDATE" />
            </intent-filter>
            <meta-data
                android:name="android.appwidget.provider"
                android:resource="@xml/widget_plugin_1x1_info" />
        </receiver>

        <!-- 计时器 1x1 -->
        <receiver
            android:name=".widget.providers.TimerWidgetProvider"
            android:exported="true">
            <intent-filter>
                <action android:name="android.appwidget.action.APPWIDGET_UPDATE" />
            </intent-filter>
            <meta-data
                android:name="android.appwidget.provider"
                android:resource="@xml/widget_plugin_1x1_info" />
        </receiver>

        <!-- 账单 1x1 -->
        <receiver
            android:name=".widget.providers.BillWidgetProvider"
            android:exported="true">
            <intent-filter>
                <action android:name="android.appwidget.action.APPWIDGET_UPDATE" />
            </intent-filter>
            <meta-data
                android:name="android.appwidget.provider"
                android:resource="@xml/widget_plugin_1x1_info" />
        </receiver>

        <!-- 日历 1x1 -->
        <receiver
            android:name=".widget.providers.CalendarWidgetProvider"
            android:exported="true">
            <intent-filter>
                <action android:name="android.appwidget.action.APPWIDGET_UPDATE" />
            </intent-filter>
            <meta-data
                android:name="android.appwidget.provider"
                android:resource="@xml/widget_plugin_1x1_info" />
        </receiver>

        <!-- 活动记录 1x1 -->
        <receiver
            android:name=".widget.providers.ActivityWidgetProvider"
            android:exported="true">
            <intent-filter>
                <action android:name="android.appwidget.action.APPWIDGET_UPDATE" />
            </intent-filter>
            <meta-data
                android:name="android.appwidget.provider"
                android:resource="@xml/widget_plugin_1x1_info" />
        </receiver>

        <!-- 目标追踪 1x1 -->
        <receiver
            android:name=".widget.providers.TrackerWidgetProvider"
            android:exported="true">
            <intent-filter>
                <action android:name="android.appwidget.action.APPWIDGET_UPDATE" />
            </intent-filter>
            <meta-data
                android:name="android.appwidget.provider"
                android:resource="@xml/widget_plugin_1x1_info" />
        </receiver>

        <!-- 习惯 1x1 -->
        <receiver
            android:name=".widget.providers.HabitsWidgetProvider"
            android:exported="true">
            <intent-filter>
                <action android:name="android.appwidget.action.APPWIDGET_UPDATE" />
            </intent-filter>
            <meta-data
                android:name="android.appwidget.provider"
                android:resource="@xml/widget_plugin_1x1_info" />
        </receiver>

        <!-- 日记 1x1 -->
        <receiver
            android:name=".widget.providers.DiaryWidgetProvider"
            android:exported="true">
            <intent-filter>
                <action android:name="android.appwidget.action.APPWIDGET_UPDATE" />
            </intent-filter>
            <meta-data
                android:name="android.appwidget.provider"
                android:resource="@xml/widget_plugin_1x1_info" />
        </receiver>

        <!-- 签到 1x1 -->
        <receiver
            android:name=".widget.providers.CheckinWidgetProvider"
            android:exported="true">
            <intent-filter>
                <action android:name="android.appwidget.action.APPWIDGET_UPDATE" />
            </intent-filter>
            <meta-data
                android:name="android.appwidget.provider"
                android:resource="@xml/widget_plugin_1x1_info" />
        </receiver>

        <!-- 节点 1x1 -->
        <receiver
            android:name=".widget.providers.NodesWidgetProvider"
            android:exported="true">
            <intent-filter>
                <action android:name="android.appwidget.action.APPWIDGET_UPDATE" />
            </intent-filter>
            <meta-data
                android:name="android.appwidget.provider"
                android:resource="@xml/widget_plugin_1x1_info" />
        </receiver>

        <!-- 数据库 1x1 -->
        <receiver
            android:name=".widget.providers.DatabaseWidgetProvider"
            android:exported="true">
            <intent-filter>
                <action android:name="android.appwidget.action.APPWIDGET_UPDATE" />
            </intent-filter>
            <meta-data
                android:name="android.appwidget.provider"
                android:resource="@xml/widget_plugin_1x1_info" />
        </receiver>

        <!-- 联系人 1x1 -->
        <receiver
            android:name=".widget.providers.ContactWidgetProvider"
            android:exported="true">
            <intent-filter>
                <action android:name="android.appwidget.action.APPWIDGET_UPDATE" />
            </intent-filter>
            <meta-data
                android:name="android.appwidget.provider"
                android:resource="@xml/widget_plugin_1x1_info" />
        </receiver>

        <!-- 纪念日 1x1 -->
        <receiver
            android:name=".widget.providers.DayWidgetProvider"
            android:exported="true">
            <intent-filter>
                <action android:name="android.appwidget.action.APPWIDGET_UPDATE" />
            </intent-filter>
            <meta-data
                android:name="android.appwidget.provider"
                android:resource="@xml/widget_plugin_1x1_info" />
        </receiver>

        <!-- 物品管理 1x1 -->
        <receiver
            android:name=".widget.providers.GoodsWidgetProvider"
            android:exported="true">
            <intent-filter>
                <action android:name="android.appwidget.action.APPWIDGET_UPDATE" />
            </intent-filter>
            <meta-data
                android:name="android.appwidget.provider"
                android:resource="@xml/widget_plugin_1x1_info" />
        </receiver>

        <!-- 笔记 1x1 -->
        <receiver
            android:name=".widget.providers.NotesWidgetProvider"
            android:exported="true">
            <intent-filter>
                <action android:name="android.appwidget.action.APPWIDGET_UPDATE" />
            </intent-filter>
            <meta-data
                android:name="android.appwidget.provider"
                android:resource="@xml/widget_plugin_1x1_info" />
        </receiver>

        <!-- 商店 1x1 -->
        <receiver
            android:name=".widget.providers.StoreWidgetProvider"
            android:exported="true">
            <intent-filter>
                <action android:name="android.appwidget.action.APPWIDGET_UPDATE" />
            </intent-filter>
            <meta-data
                android:name="android.appwidget.provider"
                android:resource="@xml/widget_plugin_1x1_info" />
        </receiver>

        <!-- OpenAI 1x1 -->
        <receiver
            android:name=".widget.providers.OpenaiWidgetProvider"
            android:exported="true">
            <intent-filter>
                <action android:name="android.appwidget.action.APPWIDGET_UPDATE" />
            </intent-filter>
            <meta-data
                android:name="android.appwidget.provider"
                android:resource="@xml/widget_plugin_1x1_info" />
        </receiver>

        <!-- AI对话 1x1 -->
        <receiver
            android:name=".widget.providers.AgentChatWidgetProvider"
            android:exported="true">
            <intent-filter>
                <action android:name="android.appwidget.action.APPWIDGET_UPDATE" />
            </intent-filter>
            <meta-data
                android:name="android.appwidget.provider"
                android:resource="@xml/widget_plugin_1x1_info" />
        </receiver>

        <!-- 日记相册 1x1 -->
        <receiver
            android:name=".widget.providers.CalendarAlbumWidgetProvider"
            android:exported="true">
            <intent-filter>
                <action android:name="android.appwidget.action.APPWIDGET_UPDATE" />
            </intent-filter>
            <meta-data
                android:name="android.appwidget.provider"
                android:resource="@xml/widget_plugin_1x1_info" />
        </receiver>

        <!-- 聊天 1x1 -->
        <receiver
            android:name=".widget.providers.ChatWidgetProvider"
            android:exported="true">
            <intent-filter>
                <action android:name="android.appwidget.action.APPWIDGET_UPDATE" />
            </intent-filter>
            <meta-data
                android:name="android.appwidget.provider"
                android:resource="@xml/widget_plugin_1x1_info" />
        </receiver>

        <!-- ========== 插件小组件 2x1 尺寸 ========== -->

        <!-- 待办事项 2x1 -->
        <receiver
            android:name=".widget.providers.TodoWidget2x1Provider"
            android:exported="true">
            <intent-filter>
                <action android:name="android.appwidget.action.APPWIDGET_UPDATE" />
            </intent-filter>
            <meta-data
                android:name="android.appwidget.provider"
                android:resource="@xml/widget_plugin_2x1_info" />
        </receiver>

        <!-- 计时器 2x1 -->
        <receiver
            android:name=".widget.providers.TimerWidget2x1Provider"
            android:exported="true">
            <intent-filter>
                <action android:name="android.appwidget.action.APPWIDGET_UPDATE" />
            </intent-filter>
            <meta-data
                android:name="android.appwidget.provider"
                android:resource="@xml/widget_plugin_2x1_info" />
        </receiver>

        <!-- 账单 2x1 -->
        <receiver
            android:name=".widget.providers.BillWidget2x1Provider"
            android:exported="true">
            <intent-filter>
                <action android:name="android.appwidget.action.APPWIDGET_UPDATE" />
            </intent-filter>
            <meta-data
                android:name="android.appwidget.provider"
                android:resource="@xml/widget_plugin_2x1_info" />
        </receiver>

        <!-- 日历 2x1 -->
        <receiver
            android:name=".widget.providers.CalendarWidget2x1Provider"
            android:exported="true">
            <intent-filter>
                <action android:name="android.appwidget.action.APPWIDGET_UPDATE" />
            </intent-filter>
            <meta-data
                android:name="android.appwidget.provider"
                android:resource="@xml/widget_plugin_2x1_info" />
        </receiver>

        <!-- 活动记录 2x1 -->
        <receiver
            android:name=".widget.providers.ActivityWidget2x1Provider"
            android:exported="true">
            <intent-filter>
                <action android:name="android.appwidget.action.APPWIDGET_UPDATE" />
            </intent-filter>
            <meta-data
                android:name="android.appwidget.provider"
                android:resource="@xml/widget_plugin_2x1_info" />
        </receiver>

        <!-- 目标追踪 2x1 -->
        <receiver
            android:name=".widget.providers.TrackerWidget2x1Provider"
            android:exported="true">
            <intent-filter>
                <action android:name="android.appwidget.action.APPWIDGET_UPDATE" />
            </intent-filter>
            <meta-data
                android:name="android.appwidget.provider"
                android:resource="@xml/widget_plugin_2x1_info" />
        </receiver>

        <!-- 习惯 2x1 -->
        <receiver
            android:name=".widget.providers.HabitsWidget2x1Provider"
            android:exported="true">
            <intent-filter>
                <action android:name="android.appwidget.action.APPWIDGET_UPDATE" />
            </intent-filter>
            <meta-data
                android:name="android.appwidget.provider"
                android:resource="@xml/widget_plugin_2x1_info" />
        </receiver>

        <!-- 日记 2x1 -->
        <receiver
            android:name=".widget.providers.DiaryWidget2x1Provider"
            android:exported="true">
            <intent-filter>
                <action android:name="android.appwidget.action.APPWIDGET_UPDATE" />
            </intent-filter>
            <meta-data
                android:name="android.appwidget.provider"
                android:resource="@xml/widget_plugin_2x1_info" />
        </receiver>

        <!-- 签到 2x1 -->
        <receiver
            android:name=".widget.providers.CheckinWidget2x1Provider"
            android:exported="true">
            <intent-filter>
                <action android:name="android.appwidget.action.APPWIDGET_UPDATE" />
            </intent-filter>
            <meta-data
                android:name="android.appwidget.provider"
                android:resource="@xml/widget_plugin_2x1_info" />
        </receiver>

        <!-- 节点 2x1 -->
        <receiver
            android:name=".widget.providers.NodesWidget2x1Provider"
            android:exported="true">
            <intent-filter>
                <action android:name="android.appwidget.action.APPWIDGET_UPDATE" />
            </intent-filter>
            <meta-data
                android:name="android.appwidget.provider"
                android:resource="@xml/widget_plugin_2x1_info" />
        </receiver>

        <!-- 数据库 2x1 -->
        <receiver
            android:name=".widget.providers.DatabaseWidget2x1Provider"
            android:exported="true">
            <intent-filter>
                <action android:name="android.appwidget.action.APPWIDGET_UPDATE" />
            </intent-filter>
            <meta-data
                android:name="android.appwidget.provider"
                android:resource="@xml/widget_plugin_2x1_info" />
        </receiver>

        <!-- 联系人 2x1 -->
        <receiver
            android:name=".widget.providers.ContactWidget2x1Provider"
            android:exported="true">
            <intent-filter>
                <action android:name="android.appwidget.action.APPWIDGET_UPDATE" />
            </intent-filter>
            <meta-data
                android:name="android.appwidget.provider"
                android:resource="@xml/widget_plugin_2x1_info" />
        </receiver>

        <!-- 纪念日 2x1 -->
        <receiver
            android:name=".widget.providers.DayWidget2x1Provider"
            android:exported="true">
            <intent-filter>
                <action android:name="android.appwidget.action.APPWIDGET_UPDATE" />
            </intent-filter>
            <meta-data
                android:name="android.appwidget.provider"
                android:resource="@xml/widget_plugin_2x1_info" />
        </receiver>

        <!-- 物品管理 2x1 -->
        <receiver
            android:name=".widget.providers.GoodsWidget2x1Provider"
            android:exported="true">
            <intent-filter>
                <action android:name="android.appwidget.action.APPWIDGET_UPDATE" />
            </intent-filter>
            <meta-data
                android:name="android.appwidget.provider"
                android:resource="@xml/widget_plugin_2x1_info" />
        </receiver>

        <!-- 笔记 2x1 -->
        <receiver
            android:name=".widget.providers.NotesWidget2x1Provider"
            android:exported="true">
            <intent-filter>
                <action android:name="android.appwidget.action.APPWIDGET_UPDATE" />
            </intent-filter>
            <meta-data
                android:name="android.appwidget.provider"
                android:resource="@xml/widget_plugin_2x1_info" />
        </receiver>

        <!-- 商店 2x1 -->
        <receiver
            android:name=".widget.providers.StoreWidget2x1Provider"
            android:exported="true">
            <intent-filter>
                <action android:name="android.appwidget.action.APPWIDGET_UPDATE" />
            </intent-filter>
            <meta-data
                android:name="android.appwidget.provider"
                android:resource="@xml/widget_plugin_2x1_info" />
        </receiver>

        <!-- OpenAI 2x1 -->
        <receiver
            android:name=".widget.providers.OpenaiWidget2x1Provider"
            android:exported="true">
            <intent-filter>
                <action android:name="android.appwidget.action.APPWIDGET_UPDATE" />
            </intent-filter>
            <meta-data
                android:name="android.appwidget.provider"
                android:resource="@xml/widget_plugin_2x1_info" />
        </receiver>

        <!-- AI对话 2x1 -->
        <receiver
            android:name=".widget.providers.AgentChatWidget2x1Provider"
            android:exported="true">
            <intent-filter>
                <action android:name="android.appwidget.action.APPWIDGET_UPDATE" />
            </intent-filter>
            <meta-data
                android:name="android.appwidget.provider"
                android:resource="@xml/widget_plugin_2x1_info" />
        </receiver>

        <!-- 日记相册 2x1 -->
        <receiver
            android:name=".widget.providers.CalendarAlbumWidget2x1Provider"
            android:exported="true">
            <intent-filter>
                <action android:name="android.appwidget.action.APPWIDGET_UPDATE" />
            </intent-filter>
            <meta-data
                android:name="android.appwidget.provider"
                android:resource="@xml/widget_plugin_2x1_info" />
        </receiver>

        <!-- 聊天 2x1 -->
        <receiver
            android:name=".widget.providers.ChatWidget2x1Provider"
            android:exported="true">
            <intent-filter>
                <action android:name="android.appwidget.action.APPWIDGET_UPDATE" />
            </intent-filter>
            <meta-data
                android:name="android.appwidget.provider"
                android:resource="@xml/widget_plugin_2x1_info" />
        </receiver>

    </application>
    <!-- Required to query activities that can process text, see:
         https://developer.android.com/training/package-visibility and
         https://developer.android.com/reference/android/content/Intent#ACTION_PROCESS_TEXT.

         In particular, this is used by the Flutter engine in io.flutter.plugin.text.ProcessTextPlugin. -->
    <queries>
        <intent>
            <action android:name="android.intent.action.PROCESS_TEXT"/>
            <data android:mimeType="text/plain"/>
        </intent>
    </queries>
</manifest>
