# Agent Chat é“¾å¼è°ƒç”¨åŠŸèƒ½æŠ€æœ¯æ–‡æ¡£

> **æ–‡æ¡£ç‰ˆæœ¬**ï¼š1.0
> **åˆ›å»ºæ—¶é—´**ï¼š2025-12-21
> **åŠŸèƒ½çŠ¶æ€**ï¼šâœ… å·²å®Œæˆå¹¶é€šè¿‡ç¼–è¯‘æµ‹è¯•

---

## ğŸ“‹ ç›®å½•

1. [åŠŸèƒ½æ¦‚è¿°](#åŠŸèƒ½æ¦‚è¿°)
2. [ç”¨æˆ·éœ€æ±‚](#ç”¨æˆ·éœ€æ±‚)
3. [æ¶æ„è®¾è®¡](#æ¶æ„è®¾è®¡)
4. [æ•°æ®æ¨¡å‹](#æ•°æ®æ¨¡å‹)
5. [æ ¸å¿ƒå®ç°](#æ ¸å¿ƒå®ç°)
6. [UI å®ç°](#ui-å®ç°)
7. [ä½¿ç”¨æŒ‡å—](#ä½¿ç”¨æŒ‡å—)
8. [æŠ€æœ¯ç»†èŠ‚](#æŠ€æœ¯ç»†èŠ‚)
9. [æµ‹è¯•å»ºè®®](#æµ‹è¯•å»ºè®®)

---

## åŠŸèƒ½æ¦‚è¿°

### èƒŒæ™¯

åœ¨åŸæœ‰çš„ agent_chat æ’ä»¶ä¸­ï¼Œæ¯ä¸ªä¼šè¯åªèƒ½ç»‘å®šä¸€ä¸ª Agentã€‚ä¸ºäº†æ”¯æŒæ›´å¤æ‚çš„å¤„ç†æµç¨‹ï¼Œéœ€è¦å®ç° **Agent é“¾å¼è°ƒç”¨**åŠŸèƒ½ï¼Œå…è®¸å°†å¤šä¸ª Agent æŒ‰é¡ºåºæ‰§è¡Œï¼Œæ¯ä¸ª Agent çš„è¾“å‡ºä½œä¸ºä¸‹ä¸€ä¸ª Agent çš„è¾“å…¥ã€‚

### æ ¸å¿ƒç‰¹æ€§

- âœ… **å¤š Agent é¡ºåºæ‰§è¡Œ**ï¼šé…ç½® 2+ ä¸ª Agent å½¢æˆå¤„ç†é“¾
- âœ… **ä¸‰ç§ä¸Šä¸‹æ–‡æ¨¡å¼**ï¼šçµæ´»é€‰æ‹©æ¯ä¸ª Agent çš„è¾“å…¥æ¥æº
- âœ… **é”™è¯¯å³åœæ­¢**ï¼šä»»ä¸€ Agent å¤±è´¥åˆ™ä¸­æ–­é“¾å¼è°ƒç”¨
- âœ… **å¯è§†åŒ–åé¦ˆ**ï¼šæ˜¾ç¤ºæ¯ä¸ª Agent çš„ä¸­é—´è¾“å‡º
- âœ… **å‘åå…¼å®¹**ï¼šç°æœ‰å• Agent ä¼šè¯æ— ç¼è¿ç§»

### åº”ç”¨åœºæ™¯

**ç¤ºä¾‹1ï¼šå†…å®¹ç”Ÿæˆæµæ°´çº¿**
```
ç”¨æˆ·è¾“å…¥ï¼š"å†™ä¸€ç¯‡å…³äº AI çš„ç§‘æ™®æ–‡ç« "
  â†“
Agent 1 (å¤§çº²ç”Ÿæˆ): ç”Ÿæˆæ–‡ç« ç»“æ„
  â†“
Agent 2 (å†…å®¹å¡«å……): åŸºäºå¤§çº²æ’°å†™è¯¦ç»†å†…å®¹
  â†“
Agent 3 (é£æ ¼æ¶¦è‰²): ä¼˜åŒ–è¯­è¨€é£æ ¼
  â†“
æœ€ç»ˆè¾“å‡ºï¼šå®Œæ•´çš„ç§‘æ™®æ–‡ç« 
```

**ç¤ºä¾‹2ï¼šæ•°æ®åˆ†ææµç¨‹**
```
ç”¨æˆ·è¾“å…¥ï¼š"åˆ†æè¿™æ®µæ–‡æœ¬çš„æƒ…æ„Ÿ"
  â†“
Agent 1 (æƒ…æ„Ÿè¯†åˆ«): è¯†åˆ«æƒ…æ„Ÿå€¾å‘å’Œå¼ºåº¦
  â†“
Agent 2 (åŸå› åˆ†æ): åˆ†ææƒ…æ„Ÿäº§ç”Ÿçš„åŸå› 
  â†“
Agent 3 (æŠ¥å‘Šç”Ÿæˆ): ç”Ÿæˆå¯è§†åŒ–åˆ†ææŠ¥å‘Š
```

---

## ç”¨æˆ·éœ€æ±‚

### éœ€æ±‚ç¡®è®¤ï¼ˆæ¥è‡ªç”¨æˆ·ï¼‰

1. **é…ç½®çº§åˆ«**ï¼šä¼šè¯çº§ï¼ˆæ¯ä¸ªä¼šè¯ç»‘å®šä¸€ä¸ª agent é“¾ï¼‰
2. **ä¸Šä¸‹æ–‡æ¨¡å¼**ï¼šä¸‰ç§å¯é€‰æ¨¡å¼
   - ä¼šè¯ä¸Šä¸‹æ–‡ï¼šä½¿ç”¨å†å²æ¶ˆæ¯ï¼ˆéµå¾ª contextMessageCountï¼‰
   - é“¾å¼ä¸Šä¸‹æ–‡ï¼šä¼ é€’æ‰€æœ‰å‰åº agent çš„è¾“å‡º
   - ä»…ä¸Šä¸€æ­¥ï¼šä»…ä¼ é€’ä¸Šä¸€ä¸ª agent çš„è¾“å‡º
3. **é”™è¯¯å¤„ç†**ï¼šä»»ä¸€ agent å¤±è´¥åˆ™ç«‹å³åœæ­¢
4. **UI å±•ç¤º**ï¼šæ˜¾ç¤ºæ¯ä¸ª agent çš„ä¸­é—´è¾“å‡º

### éåŠŸèƒ½éœ€æ±‚

- **æ€§èƒ½**ï¼šæ”¯æŒæµå¼å“åº”ï¼Œå®æ—¶æ›´æ–° UI
- **å…¼å®¹æ€§**ï¼šå‘åå…¼å®¹æ—§çš„å• agent æ•°æ®
- **å¯ç»´æŠ¤æ€§**ï¼šä»£ç ç»“æ„æ¸…æ™°ï¼Œæ˜“äºæ‰©å±•

---

## æ¶æ„è®¾è®¡

### ç³»ç»Ÿæ¶æ„å›¾

```mermaid
graph TB
    User[ç”¨æˆ·] -->|å‘é€æ¶ˆæ¯| ChatScreen[ChatScreen UI]
    ChatScreen -->|åˆ›å»ºä¼šè¯| Controller[ChatController]

    Controller -->|åˆ¤æ–­æ¨¡å¼| ModeSwitch{å•/é“¾æ¨¡å¼?}
    ModeSwitch -->|å• Agent| SingleExec[_requestAIResponse]
    ModeSwitch -->|Agent é“¾| ChainExec[_executeAgentChain]

    ChainExec -->|éå†èŠ‚ç‚¹| Loop[For each AgentChainNode]
    Loop -->|æ„å»ºä¸Šä¸‹æ–‡| BuildContext[_buildChainContextMessages]
    Loop -->|è°ƒç”¨ Agent| RequestAgent[_requestAgentInChain]

    BuildContext -->|ä¸‰ç§æ¨¡å¼| ContextMode{ä¸Šä¸‹æ–‡æ¨¡å¼}
    ContextMode -->|ä¼šè¯ä¸Šä¸‹æ–‡| HistoryMsg[ä¼šè¯å†å²æ¶ˆæ¯]
    ContextMode -->|é“¾å¼ä¸Šä¸‹æ–‡| ChainMsg[å‰åºæ‰€æœ‰è¾“å‡º]
    ContextMode -->|ä»…ä¸Šä¸€æ­¥| PrevMsg[ä¸Šä¸€ä¸ªè¾“å‡º]

    RequestAgent -->|æµå¼å“åº”| StreamResp[RequestService.streamResponse]
    StreamResp -->|å®æ—¶æ›´æ–°| MessageService[MessageService]
    MessageService -->|é€šçŸ¥ UI| ChatScreen

    ChatScreen -->|æ˜¾ç¤º| MessageBubble[MessageBubble + Agentæ ‡ç­¾]
```

### æ•°æ®æµå›¾

```
ç”¨æˆ·è¾“å…¥ â†’ ä¿å­˜ç”¨æˆ·æ¶ˆæ¯ â†’ åˆ¤æ–­æ¨¡å¼
  â†“
[é“¾å¼æ¨¡å¼]
  â†“
éå† AgentChainNode (æŒ‰ order æ’åº)
  â†“
  [æ­¥éª¤ i]
    1. åˆ›å»º AI æ¶ˆæ¯å ä½ç¬¦
    2. æ ¹æ® contextMode æ„å»ºæ¶ˆæ¯åˆ—è¡¨
    3. è°ƒç”¨ Agent (æµå¼å“åº”)
    4. ä¿å­˜è¾“å‡ºåˆ° chainMessages[i]
    5. æ£€æŸ¥æ˜¯å¦å¤±è´¥æˆ–å–æ¶ˆ â†’ æ˜¯åˆ™åœæ­¢
  â†“
ä¸‹ä¸€ä¸ªèŠ‚ç‚¹
```

---

## æ•°æ®æ¨¡å‹

### 1. AgentChainNodeï¼ˆæ–°å¢ï¼‰

**æ–‡ä»¶ä½ç½®**ï¼š`lib/plugins/agent_chat/models/agent_chain_node.dart`

```dart
/// Agent é“¾èŠ‚ç‚¹çš„ä¸Šä¸‹æ–‡æ¨¡å¼
enum AgentContextMode {
  conversationContext,  // ä¼šè¯ä¸Šä¸‹æ–‡
  chainContext,         // é“¾å¼ä¸Šä¸‹æ–‡
  previousOnly,         // ä»…ä¸Šä¸€æ­¥
}

/// Agent é“¾ä¸­çš„å•ä¸ªèŠ‚ç‚¹é…ç½®
class AgentChainNode {
  final String agentId;              // Agent ID
  final AgentContextMode contextMode; // ä¸Šä¸‹æ–‡æ¨¡å¼
  final int order;                    // æ‰§è¡Œé¡ºåºï¼ˆä»0å¼€å§‹ï¼‰

  // åºåˆ—åŒ–/ååºåˆ—åŒ–æ–¹æ³•
  Map<String, dynamic> toJson();
  factory AgentChainNode.fromJson(Map<String, dynamic> json);
  AgentChainNode copyWith({...});
}
```

**è®¾è®¡è¦ç‚¹**ï¼š
- `order` å­—æ®µç¡®ä¿æ‰§è¡Œé¡ºåºå¯æ§
- `contextMode` ä¸ºæ¯ä¸ªèŠ‚ç‚¹ç‹¬ç«‹é…ç½®ä¸Šä¸‹æ–‡ç­–ç•¥
- æ”¯æŒå®Œæ•´çš„åºåˆ—åŒ–ä»¥æŒä¹…åŒ–é…ç½®

### 2. Conversationï¼ˆæ‰©å±•ï¼‰

**æ–‡ä»¶ä½ç½®**ï¼š`lib/plugins/agent_chat/models/conversation.dart`

```dart
class Conversation {
  // åŸæœ‰å­—æ®µ
  final String id;
  String title;
  final String? agentId;  // å• agent æ¨¡å¼ï¼ˆå‘åå…¼å®¹ï¼‰

  // æ–°å¢å­—æ®µ
  final List<AgentChainNode>? agentChain;  // agent é“¾é…ç½®

  // æ–°å¢ getter
  bool get isChainMode => agentChain != null && agentChain!.isNotEmpty;
  List<String> get effectiveAgentIds => isChainMode
      ? agentChain!.map((n) => n.agentId).toList()
      : (agentId != null ? [agentId!] : []);
}
```

**å‘åå…¼å®¹ç­–ç•¥**ï¼š
- ä¿ç•™ `agentId` å­—æ®µç”¨äºæ—§æ•°æ®
- `isChainMode` è‡ªåŠ¨åˆ¤æ–­ä½¿ç”¨å“ªç§æ¨¡å¼
- `toJson()` ä»…åœ¨é“¾éç©ºæ—¶åºåˆ—åŒ– `agentChain`

### 3. ChatMessageï¼ˆæ‰©å±•ï¼‰

**æ–‡ä»¶ä½ç½®**ï¼š`lib/plugins/agent_chat/models/chat_message.dart`

```dart
class ChatMessage {
  // åŸæœ‰å­—æ®µ...

  // æ–°å¢å­—æ®µï¼ˆé“¾å¼æ¨¡å¼ä¸“ç”¨ï¼‰
  String? generatedByAgentId;  // ç”Ÿæˆæ­¤æ¶ˆæ¯çš„ Agent ID
  int? chainStepIndex;         // åœ¨é“¾ä¸­çš„æ­¥éª¤ç´¢å¼•
}
```

**ç”¨é€”**ï¼š
- `generatedByAgentId`ï¼šç”¨äºåœ¨ UI ä¸­æ˜¾ç¤º Agent æ ‡ç­¾
- `chainStepIndex`ï¼šæ ‡è¯†æ¶ˆæ¯åœ¨é“¾ä¸­çš„ä½ç½®ï¼ˆ0-basedï¼‰

---

## æ ¸å¿ƒå®ç°

### 1. ChatController ä¿®æ”¹

**æ–‡ä»¶ä½ç½®**ï¼š`lib/plugins/agent_chat/controllers/chat_controller.dart`

#### æ–°å¢å­—æ®µ

```dart
class ChatController {
  // åŸæœ‰
  AIAgent? _currentAgent;

  // æ–°å¢
  List<AIAgent>? _agentChain;

  // getter
  bool get isChainMode => conversation.isChainMode;
  List<AIAgent> get agentChain => _agentChain ?? [];
}
```

#### åˆå§‹åŒ–æµç¨‹

```dart
Future<void> initialize() async {
  // ...

  // åˆ¤æ–­æ¨¡å¼å¹¶åŠ è½½
  if (conversation.isChainMode) {
    await _loadAgentChain(conversation.agentChain!);
  } else if (conversation.agentId != null) {
    await _loadAgentInBackground(conversation.agentId!);
  }

  // ...
}
```

#### åŠ è½½ Agent é“¾

```dart
Future<void> _loadAgentChain(List<AgentChainNode> chainNodes) async {
  final openAIPlugin = PluginManager.instance.getPlugin('openai') as OpenAIPlugin?;
  if (openAIPlugin == null) return;

  _agentChain = [];

  // æŒ‰ order æ’åº
  final sortedNodes = List<AgentChainNode>.from(chainNodes)
    ..sort((a, b) => a.order.compareTo(b.order));

  // ä¾æ¬¡åŠ è½½æ¯ä¸ª agent
  for (final node in sortedNodes) {
    final agent = await openAIPlugin.controller.getAgent(node.agentId);
    if (agent != null) {
      _agentChain!.add(agent);
    }
  }

  // è®¾ç½®å½“å‰ agent ä¸ºç¬¬ä¸€ä¸ª
  if (_agentChain!.isNotEmpty) {
    _currentAgent = _agentChain!.first;
  }
}
```

### 2. é“¾å¼æ‰§è¡Œæ ¸å¿ƒé€»è¾‘

#### å…¥å£ï¼šsendMessage()

```dart
Future<void> sendMessage() async {
  // éªŒè¯
  if (!isChainMode && _currentAgent == null) {
    throw Exception('æœªé€‰æ‹©Agent');
  }
  if (isChainMode && _agentChain!.isEmpty) {
    throw Exception('Agenté“¾ä¸ºç©º');
  }

  // ä¿å­˜ç”¨æˆ·æ¶ˆæ¯...

  // æ¨¡å¼åˆ†å‘
  if (isChainMode) {
    await _executeAgentChain(userInput, files, selectedTemplate);
  } else {
    // åŸæœ‰å• agent é€»è¾‘
    await _requestAIResponse(aiMessage.id, userInput, files);
  }
}
```

#### æ ¸å¿ƒï¼š_executeAgentChain()

```dart
Future<void> _executeAgentChain(
  String userInput,
  List<File> files,
  SavedToolTemplate? selectedTemplate,
) async {
  final chainNodes = conversation.agentChain!;
  final sortedNodes = List<AgentChainNode>.from(chainNodes)
    ..sort((a, b) => a.order.compareTo(b.order));

  // å­˜å‚¨æ¯ä¸ª agent çš„è¾“å‡º
  final chainMessages = <ChatMessage>[];

  // éå†æ‰§è¡Œ
  for (int i = 0; i < sortedNodes.length; i++) {
    final node = sortedNodes[i];
    final agent = _agentChain![i];

    // 1. åˆ›å»º AI æ¶ˆæ¯å ä½ç¬¦
    final aiMessage = ChatMessage.ai(
      conversationId: conversation.id,
      content: '',
      isGenerating: true,
      generatedByAgentId: agent.id,
      chainStepIndex: i,
    );
    await messageService.addMessage(aiMessage);
    chainMessages.add(aiMessage);

    try {
      // 2. æ„å»ºä¸Šä¸‹æ–‡æ¶ˆæ¯
      final contextMessages = _buildChainContextMessages(
        node: node,
        stepIndex: i,
        userInput: userInput,
        previousMessages: chainMessages,
      );

      // 3. è°ƒç”¨ agent
      await _requestAgentInChain(
        agent: agent,
        aiMessageId: aiMessage.id,
        contextMessages: contextMessages,
        files: i == 0 ? files : [], // åªæœ‰ç¬¬ä¸€ä¸ªå¤„ç†æ–‡ä»¶
        enableToolCalling: agent.enableFunctionCalling,
      );

      // 4. æ£€æŸ¥æ˜¯å¦å–æ¶ˆ
      if (_isCancelling) break;

      // 5. æ›´æ–°æ¶ˆæ¯
      final updatedMessage = messageService.getMessage(conversation.id, aiMessage.id);
      if (updatedMessage != null) {
        chainMessages[i] = updatedMessage;
      }

    } catch (e) {
      // é”™è¯¯å¤„ç†ï¼šæ ‡è®°å¤±è´¥å¹¶åœæ­¢
      final errorMessage = messageService.getMessage(conversation.id, aiMessage.id);
      if (errorMessage != null) {
        final updated = errorMessage.copyWith(
          content: 'âŒ æ‰§è¡Œå¤±è´¥: $e',
          isGenerating: false,
        );
        await messageService.updateMessage(updated);
      }
      break; // åœæ­¢åç»­æ‰§è¡Œ
    }
  }
}
```

### 3. ä¸Šä¸‹æ–‡æ„å»ºé€»è¾‘

```dart
List<ChatCompletionMessage> _buildChainContextMessages({
  required AgentChainNode node,
  required int stepIndex,
  required String userInput,
  required List<ChatMessage> previousMessages,
}) {
  final messages = <ChatCompletionMessage>[];
  final agent = _agentChain![stepIndex];

  // æ·»åŠ ç³»ç»Ÿæç¤ºè¯
  if (agent.systemPrompt.isNotEmpty) {
    messages.add(ChatCompletionMessage.system(content: agent.systemPrompt));
  }

  switch (node.contextMode) {
    case AgentContextMode.conversationContext:
      // ä½¿ç”¨ä¼šè¯å†å²ï¼ˆå¤ç”¨ç°æœ‰ _buildContextMessagesï¼‰
      final historyMessages = _buildContextMessages(userInput);
      messages.addAll(historyMessages);
      break;

    case AgentContextMode.chainContext:
      // ç”¨æˆ·è¾“å…¥ + æ‰€æœ‰å‰åºè¾“å‡º
      messages.add(ChatCompletionMessage.user(
        content: ChatCompletionUserMessageContent.string(userInput),
      ));

      for (int i = 0; i < stepIndex; i++) {
        final prevMsg = previousMessages[i];
        if (prevMsg.content.isNotEmpty) {
          final prevAgent = _agentChain![i];
          messages.add(ChatCompletionMessage.assistant(
            content: '[${prevAgent.name}]: ${prevMsg.content}',
          ));
        }
      }
      break;

    case AgentContextMode.previousOnly:
      // ä»…ä¸Šä¸€æ­¥çš„è¾“å‡ºï¼ˆæˆ–ç”¨æˆ·è¾“å…¥ï¼‰
      final inputContent = stepIndex == 0
          ? userInput
          : previousMessages[stepIndex - 1].content;

      messages.add(ChatCompletionMessage.user(
        content: ChatCompletionUserMessageContent.string(inputContent),
      ));
      break;
  }

  return messages;
}
```

**å…³é”®ç‚¹**ï¼š
- `conversationContext` æ¨¡å¼å¤ç”¨ç°æœ‰çš„ `_buildContextMessages`ï¼Œä¿æŒä¸€è‡´æ€§
- `chainContext` æ¨¡å¼å°†å‰åº agent çš„è¾“å‡ºæ ‡è®°ä¸º assistant è§’è‰²ï¼Œä¿æŒå¯¹è¯ç»“æ„
- `previousOnly` æ¨¡å¼ç®€åŒ–è¾“å…¥ï¼Œé€‚åˆæµæ°´çº¿å¼å¤„ç†

### 4. å•ä¸ª Agent è°ƒç”¨

```dart
Future<void> _requestAgentInChain({
  required AIAgent agent,
  required String aiMessageId,
  required List<ChatCompletionMessage> contextMessages,
  required List<File> files,
  required bool enableToolCalling,
}) async {
  final buffer = StringBuffer();
  int tokenCount = 0;

  try {
    final imageFiles = files.where((f) => FilePickerHelper.isImageFile(f)).toList();

    // æµå¼è¯·æ±‚
    await RequestService.streamResponse(
      agent: agent,
      prompt: null,
      contextMessages: contextMessages,
      vision: imageFiles.isNotEmpty,
      filePath: imageFiles.isNotEmpty ? imageFiles.first.path : null,
      shouldCancel: () => _isCancelling,
      onToken: (token) {
        buffer.write(token);
        tokenCount++;

        // å®æ—¶æ›´æ–° UI
        messageService.updateAIMessageContent(
          conversation.id,
          aiMessageId,
          buffer.toString(),
          tokenCount,
        );
      },
      onComplete: () async {
        messageService.completeAIMessage(conversation.id, aiMessageId);
      },
      onError: (error) {
        messageService.updateAIMessageContent(
          conversation.id,
          aiMessageId,
          error == 'å·²å–æ¶ˆå‘é€' ? 'ğŸ›‘ ç”¨æˆ·å·²å–æ¶ˆæ“ä½œ' : 'âŒ é”™è¯¯: $error',
          0,
        );
        messageService.completeAIMessage(conversation.id, aiMessageId);
      },
    );

    // ä¿å­˜ä¸Šä¸‹æ–‡ï¼ˆç”¨äºè¯¦æƒ…æŸ¥çœ‹ï¼‰
    _contextMessagesCache[aiMessageId] = List.from(contextMessages);
  } catch (e) {
    debugPrint('âŒ è¯·æ±‚Agentå“åº”å¤±è´¥: $e');
    rethrow;
  }
}
```

**å¤ç”¨æ€§**ï¼š
- å®Œå…¨å¤ç”¨ç°æœ‰çš„ `RequestService.streamResponse`
- æµå¼å“åº”æœºåˆ¶ä¿æŒä¸€è‡´
- é”™è¯¯å¤„ç†ç»Ÿä¸€

### 5. æ¨¡å¼åˆ‡æ¢æ–¹æ³•

```dart
/// é…ç½® Agent é“¾
Future<void> selectAgentChain(List<AgentChainNode> chainNodes) async {
  await _ensureConversationServiceReady();

  // åŠ è½½ agent
  await _loadAgentChain(chainNodes);

  // æ›´æ–°ä¼šè¯
  final updatedConversation = (_currentConversation ?? conversation).copyWith(
    agentChain: chainNodes,
    clearAgentChain: false,
  );
  await conversationService.updateConversation(updatedConversation);

  _currentConversation = updatedConversation;
  notifyListeners();
}

/// åˆ‡æ¢å›å• Agent
Future<void> switchToSingleAgent(String agentId) async {
  await _ensureConversationServiceReady();

  final openAIPlugin = PluginManager.instance.getPlugin('openai') as OpenAIPlugin?;
  if (openAIPlugin != null) {
    _currentAgent = await openAIPlugin.controller.getAgent(agentId);
    _agentChain = null;  // æ¸…ç©ºé“¾

    final updatedConversation = (_currentConversation ?? conversation).copyWith(
      agentId: agentId,
      clearAgentChain: true,  // æ¸…é™¤é“¾é…ç½®
    );
    await conversationService.updateConversation(updatedConversation);

    _currentConversation = updatedConversation;
    notifyListeners();
  }
}
```

---

## UI å®ç°

### 1. Agent é“¾é…ç½®å¯¹è¯æ¡†

**æ–‡ä»¶ä½ç½®**ï¼š`lib/plugins/agent_chat/screens/chat_screen/components/agent_chain_config_dialog.dart`

#### åŠŸèƒ½ç‰¹æ€§

- âœ… æ·»åŠ /åˆ é™¤èŠ‚ç‚¹
- âœ… Agent é€‰æ‹©ï¼ˆä¸‹æ‹‰åˆ—è¡¨ï¼‰
- âœ… ä¸Šä¸‹æ–‡æ¨¡å¼é€‰æ‹©ï¼ˆä¸‹æ‹‰åˆ—è¡¨ï¼‰
- âœ… æ‹–æ‹½æ’åºï¼ˆReorderableListViewï¼‰
- âœ… ä¸Š/ä¸‹ç§»åŠ¨æŒ‰é’®
- âœ… å®æ—¶é¢„è§ˆé…ç½®

#### æ ¸å¿ƒä»£ç 

```dart
class AgentChainConfigDialog extends StatefulWidget {
  final List<AgentChainNode>? initialChain;
  final Function(List<AgentChainNode>) onSave;

  @override
  State<AgentChainConfigDialog> createState() => _AgentChainConfigDialogState();
}

class _AgentChainConfigDialogState extends State<AgentChainConfigDialog> {
  late List<AgentChainNode> _chain;
  List<AIAgent> _availableAgents = [];

  @override
  void initState() {
    super.initState();
    _chain = widget.initialChain != null ? List.from(widget.initialChain!) : [];
    _loadAgents();
  }

  Future<void> _loadAgents() async {
    final openAIPlugin = PluginManager.instance.getPlugin('openai') as OpenAIPlugin?;
    if (openAIPlugin != null) {
      _availableAgents = await openAIPlugin.controller.loadAgents();
    }
    setState(() => _isLoading = false);
  }

  void _addNode() {
    setState(() {
      _chain.add(AgentChainNode(
        agentId: _availableAgents.first.id,
        contextMode: AgentContextMode.conversationContext,
        order: _chain.length,
      ));
    });
  }

  // ... åˆ é™¤ã€ç§»åŠ¨ç­‰æ–¹æ³•

  @override
  Widget build(BuildContext context) {
    return Dialog(
      child: Container(
        // ReorderableListView å®ç°æ‹–æ‹½æ’åº
        child: ReorderableListView.builder(
          itemCount: _chain.length,
          onReorder: (oldIndex, newIndex) {
            setState(() {
              if (newIndex > oldIndex) newIndex--;
              final item = _chain.removeAt(oldIndex);
              _chain.insert(newIndex, item);

              // é‡æ–°æ’åº
              for (int i = 0; i < _chain.length; i++) {
                _chain[i] = _chain[i].copyWith(order: i);
              }
            });
          },
          itemBuilder: (context, index) {
            final node = _chain[index];

            return Card(
              key: ValueKey(index),
              child: Column(
                children: [
                  // Agent é€‰æ‹©å™¨
                  DropdownButtonFormField<String>(...),

                  // ä¸Šä¸‹æ–‡æ¨¡å¼é€‰æ‹©å™¨
                  DropdownButtonFormField<AgentContextMode>(...),

                  // è¯´æ˜æ–‡å­—
                  Text(_getContextModeDescription(node.contextMode)),
                ],
              ),
            );
          },
        ),
      ),
    );
  }
}
```

### 2. ChatScreen ä¿®æ”¹

**æ–‡ä»¶ä½ç½®**ï¼š`lib/plugins/agent_chat/screens/chat_screen/chat_screen.dart`

#### AppBar æ˜¾ç¤º

```dart
appBar: AppBar(
  title: InkWell(
    onTap: _showAgentSelector,
    child: Column(
      crossAxisAlignment: CrossAxisAlignment.start,
      children: [
        Text(widget.conversation.title),
        Row(
          children: [
            // æ¨¡å¼å›¾æ ‡
            Icon(
              _controller.isChainMode ? Icons.link : Icons.smart_toy,
              size: 14,
            ),
            SizedBox(width: 4),

            // Agent ä¿¡æ¯
            Text(_getAgentDisplayText()),

            Icon(Icons.arrow_drop_down, size: 16),
          ],
        ),
      ],
    ),
  ),
),
```

#### è¾…åŠ©æ–¹æ³•

```dart
String _getAgentDisplayText() {
  if (_controller.isChainMode) {
    final chainLength = _controller.agentChain.length;
    if (chainLength == 0) return 'é…ç½® Agent é“¾';
    return '$chainLength ä¸ª Agent é“¾';
  } else {
    return _controller.currentAgent?.name ?? 'agent_chat_selectAgent'.tr;
  }
}

bool _hasValidAgent() {
  if (_controller.isChainMode) {
    return _controller.agentChain.isNotEmpty;
  } else {
    return _controller.currentAgent != null;
  }
}
```

#### Agent é€‰æ‹©å™¨

```dart
Future<void> _showAgentSelector() async {
  // 1. æ˜¾ç¤ºæ¨¡å¼é€‰æ‹©å¯¹è¯æ¡†
  final mode = await showDialog<String>(
    context: context,
    builder: (context) => SimpleDialog(
      title: const Text('é€‰æ‹©é…ç½®æ¨¡å¼'),
      children: [
        SimpleDialogOption(
          onPressed: () => Navigator.pop(context, 'single'),
          child: ListTile(
            leading: Icon(Icons.smart_toy),
            title: Text('å• Agent æ¨¡å¼'),
          ),
        ),
        SimpleDialogOption(
          onPressed: () => Navigator.pop(context, 'chain'),
          child: ListTile(
            leading: Icon(Icons.link),
            title: Text('Agent é“¾æ¨¡å¼'),
          ),
        ),
      ],
    ),
  );

  // 2. æ ¹æ®é€‰æ‹©æ‰“å¼€å¯¹åº”çš„ç•Œé¢
  if (mode == 'single') {
    await _showSingleAgentSelector();
  } else if (mode == 'chain') {
    await _showAgentChainConfig();
  }
}

Future<void> _showAgentChainConfig() async {
  await showDialog(
    context: context,
    builder: (context) => AgentChainConfigDialog(
      initialChain: _controller.conversation.agentChain,
      onSave: (chain) async {
        try {
          await _controller.selectAgentChain(chain);
          toastService.showToast('Agent é“¾é…ç½®æˆåŠŸ');
        } catch (e) {
          toastService.showToast('é…ç½®å¤±è´¥: $e');
        }
      },
    ),
  );
}
```

### 3. MessageBubble å¢å¼º

**æ–‡ä»¶ä½ç½®**ï¼š`lib/plugins/agent_chat/screens/chat_screen/components/message_bubble.dart`

#### æ–°å¢å‚æ•°

```dart
class MessageBubble extends StatelessWidget {
  // åŸæœ‰å‚æ•°...
  final String? Function(String agentId)? getAgentName;  // æ–°å¢

  const MessageBubble({
    // ...
    this.getAgentName,
  });
}
```

#### Agent æ ‡ç­¾æ˜¾ç¤º

```dart
@override
Widget build(BuildContext context) {
  return Container(
    child: Column(
      children: [
        // Agent æ ‡ç­¾ï¼ˆé“¾å¼æ¨¡å¼ä¸‹æ˜¾ç¤ºï¼‰
        if (!isUser &&
            message.generatedByAgentId != null &&
            message.chainStepIndex != null)
          _buildAgentLabel(context),

        // æ¶ˆæ¯å†…å®¹
        // ...
      ],
    ),
  );
}

Widget _buildAgentLabel(BuildContext context) {
  final agentName = getAgentName?.call(message.generatedByAgentId!) ?? 'Agent';
  final stepIndex = message.chainStepIndex!;

  return Container(
    padding: EdgeInsets.symmetric(horizontal: 8, vertical: 4),
    decoration: BoxDecoration(
      color: Theme.of(context).colorScheme.primary.withOpacity(0.1),
      borderRadius: BorderRadius.circular(4),
      border: Border.all(
        color: Theme.of(context).colorScheme.primary.withOpacity(0.3),
      ),
    ),
    child: Row(
      mainAxisSize: MainAxisSize.min,
      children: [
        Icon(Icons.link, size: 14),
        SizedBox(width: 4),
        Text(
          'æ­¥éª¤ ${stepIndex + 1}: $agentName',
          style: TextStyle(
            fontSize: 11,
            fontWeight: FontWeight.bold,
            color: Theme.of(context).colorScheme.primary,
          ),
        ),
      ],
    ),
  );
}
```

#### å›è°ƒä¼ é€’ï¼ˆåœ¨ ChatScreen ä¸­ï¼‰

```dart
MessageBubble(
  message: message,
  // ...
  getAgentName: (agentId) {
    if (_controller.isChainMode) {
      final agent = _controller.agentChain.firstWhere(
        (a) => a.id == agentId,
        orElse: () => _controller.agentChain.first,
      );
      return agent.name;
    }
    return _controller.currentAgent?.name;
  },
)
```

---

## ä½¿ç”¨æŒ‡å—

### é…ç½® Agent é“¾

1. **æ‰“å¼€èŠå¤©ç•Œé¢**
2. **ç‚¹å‡»é¡¶éƒ¨ Agent åŒºåŸŸ**ï¼ˆæ˜¾ç¤ºå½“å‰ agent åç§°æˆ–é“¾çŠ¶æ€ï¼‰
3. **é€‰æ‹©"Agent é“¾æ¨¡å¼"**
4. **æ·»åŠ èŠ‚ç‚¹**ï¼š
   - ç‚¹å‡»"æ·»åŠ  Agent"æŒ‰é’®
   - é€‰æ‹© Agent
   - é€‰æ‹©ä¸Šä¸‹æ–‡æ¨¡å¼
   - é‡å¤æ·»åŠ æ›´å¤šèŠ‚ç‚¹
5. **è°ƒæ•´é¡ºåº**ï¼š
   - æ‹–æ‹½èŠ‚ç‚¹å¡ç‰‡
   - æˆ–ä½¿ç”¨ä¸Š/ä¸‹ç®­å¤´
6. **ä¿å­˜é…ç½®**

### ä¸Šä¸‹æ–‡æ¨¡å¼é€‰æ‹©æŒ‡å—

| æ¨¡å¼ | é€‚ç”¨åœºæ™¯ | ç¤ºä¾‹ |
|------|---------|------|
| **ä¼šè¯ä¸Šä¸‹æ–‡** | éœ€è¦å®Œæ•´å¯¹è¯å†å² | å¤šè½®å¯¹è¯ã€éœ€è¦è®°ä½å‰é¢è®¨è®ºçš„å†…å®¹ |
| **é“¾å¼ä¸Šä¸‹æ–‡** | å¤šæ­¥æ¨ç†ã€éœ€è¦æ‰€æœ‰ä¸­é—´ç»“æœ | å¤æ‚åˆ†æä»»åŠ¡ã€å¤šå±‚æ¬¡å¤„ç† |
| **ä»…ä¸Šä¸€æ­¥** | æµæ°´çº¿å¼å¤„ç†ã€æ¯æ­¥ç‹¬ç«‹ | ç¿»è¯‘ â†’ æ¶¦è‰² â†’ æ’ç‰ˆ |

### åˆ‡æ¢å›å• Agent

1. ç‚¹å‡»é¡¶éƒ¨ Agent åŒºåŸŸ
2. é€‰æ‹©"å• Agent æ¨¡å¼"
3. é€‰æ‹©ä¸€ä¸ª Agent
4. åŸæœ‰çš„é“¾é…ç½®ä¼šè¢«æ¸…é™¤

---

## æŠ€æœ¯ç»†èŠ‚

### 1. æ•°æ®æŒä¹…åŒ–

**å­˜å‚¨æ ¼å¼ï¼ˆJSONï¼‰**ï¼š

```json
{
  "id": "conv_123",
  "title": "æµ‹è¯•ä¼šè¯",
  "agentId": null,
  "agentChain": [
    {
      "agentId": "agent_001",
      "contextMode": "conversationContext",
      "order": 0
    },
    {
      "agentId": "agent_002",
      "contextMode": "previousOnly",
      "order": 1
    }
  ],
  "contextMessageCount": 10,
  // ...
}
```

**å‘åå…¼å®¹å¤„ç†**ï¼š
```dart
// è¯»å–æ—¶
factory Conversation.fromJson(Map<String, dynamic> json) {
  return Conversation(
    agentId: json['agentId'] as String?,  // å¯èƒ½ä¸º null
    agentChain: (json['agentChain'] as List<dynamic>?)  // å¯èƒ½ä¸å­˜åœ¨
        ?.map((e) => AgentChainNode.fromJson(e))
        .toList(),
  );
}

// å†™å…¥æ—¶
Map<String, dynamic> toJson() {
  return {
    'agentId': agentId,
    if (agentChain != null && agentChain!.isNotEmpty)
      'agentChain': agentChain!.map((n) => n.toJson()).toList(),
  };
}
```

### 2. é”™è¯¯å¤„ç†æœºåˆ¶

**é”™è¯¯ä¼ æ’­**ï¼š
```dart
try {
  await _requestAgentInChain(...);
} catch (e) {
  // 1. æ›´æ–°å¤±è´¥æ¶ˆæ¯
  final errorMessage = messageService.getMessage(conversation.id, aiMessage.id);
  final updated = errorMessage.copyWith(
    content: 'âŒ æ‰§è¡Œå¤±è´¥: $e',
    isGenerating: false,
  );
  await messageService.updateMessage(updated);

  // 2. ä¸­æ–­é“¾å¼è°ƒç”¨
  break;  // ä¸å†æ‰§è¡Œåç»­ agent
}
```

**å–æ¶ˆæœºåˆ¶**ï¼š
```dart
// åœ¨æ¯ä¸ª agent æ‰§è¡Œåæ£€æŸ¥
if (_isCancelling) {
  debugPrint('ğŸ›‘ é“¾å¼è°ƒç”¨è¢«ç”¨æˆ·å–æ¶ˆ');
  break;
}

// RequestService ä¸­æ£€æŸ¥
shouldCancel: () => _isCancelling,
```

### 3. æ€§èƒ½ä¼˜åŒ–

**æµå¼å“åº”**ï¼š
- æ¯ä¸ª agent çš„è¾“å‡ºå®æ—¶æ˜¾ç¤º
- ç”¨æˆ·å¯ä»¥ç«‹å³çœ‹åˆ°ä¸­é—´ç»“æœ
- ä¸éœ€è¦ç­‰å¾…æ•´ä¸ªé“¾å®Œæˆ

**æ¶ˆæ¯ç¼“å­˜**ï¼š
```dart
// æ›´æ–° chainMessages ä¸ºæœ€æ–°ç‰ˆæœ¬
final updatedMessage = messageService.getMessage(conversation.id, aiMessage.id);
if (updatedMessage != null) {
  chainMessages[i] = updatedMessage;
}
```

**ä¸Šä¸‹æ–‡æ„å»ºä¼˜åŒ–**ï¼š
```dart
// conversationContext æ¨¡å¼å¤ç”¨ç°æœ‰æ–¹æ³•
case AgentContextMode.conversationContext:
  final historyMessages = _buildContextMessages(userInput);
  messages.addAll(historyMessages);
  break;
```

### 4. æ‰©å±•æ€§è®¾è®¡

**é¢„ç•™æ‰©å±•ç‚¹**ï¼š

1. **æ¡ä»¶åˆ†æ”¯**ï¼š
```dart
// æœªæ¥å¯æ‰©å±•
class AgentChainNode {
  final String? condition;  // æ‰§è¡Œæ¡ä»¶ï¼ˆJS è¡¨è¾¾å¼ï¼‰
  final List<String>? nextNodeIds;  // ä¸‹ä¸€æ­¥å¯èƒ½çš„èŠ‚ç‚¹
}
```

2. **å¹¶è¡Œæ‰§è¡Œ**ï¼š
```dart
// æœªæ¥å¯æ‰©å±•
class AgentChainNode {
  final bool parallel;  // æ˜¯å¦å¹¶è¡Œæ‰§è¡Œ
  final String? groupId;  // å¹¶è¡Œç»„ ID
}
```

3. **ä¸­é—´ç¼–è¾‘**ï¼š
```dart
// æœªæ¥å¯æ‰©å±•
class AgentChainNode {
  final bool allowUserEdit;  // å…è®¸ç”¨æˆ·åœ¨æ­¤æ­¥éª¤ç¼–è¾‘
}
```

---

## æµ‹è¯•å»ºè®®

### åŠŸèƒ½æµ‹è¯•

**åŸºç¡€åŠŸèƒ½**ï¼š
- [ ] åˆ›å»ºåŒ…å« 2 ä¸ª agent çš„é“¾ï¼Œå‘é€æ¶ˆæ¯ï¼ŒéªŒè¯é¡ºåºæ‰§è¡Œ
- [ ] åˆ›å»ºåŒ…å« 3+ ä¸ª agent çš„é“¾ï¼ŒéªŒè¯æ‰€æœ‰ agent éƒ½æ‰§è¡Œ
- [ ] æµ‹è¯•ä¸‰ç§ä¸Šä¸‹æ–‡æ¨¡å¼ï¼ŒéªŒè¯ä¼ é€’çš„æ¶ˆæ¯æ­£ç¡®

**ä¸Šä¸‹æ–‡æ¨¡å¼**ï¼š
- [ ] `conversationContext`ï¼šéªŒè¯ä½¿ç”¨ä¼šè¯å†å²
- [ ] `chainContext`ï¼šéªŒè¯ä¼ é€’æ‰€æœ‰å‰åºè¾“å‡º
- [ ] `previousOnly`ï¼šéªŒè¯ä»…ä¼ é€’ä¸Šä¸€æ­¥è¾“å‡º

**é”™è¯¯å¤„ç†**ï¼š
- [ ] æ¨¡æ‹Ÿ agent å¤±è´¥ï¼ŒéªŒè¯åœæ­¢æ‰§è¡Œ
- [ ] ç”¨æˆ·å–æ¶ˆæ‰§è¡Œï¼ŒéªŒè¯ä¸­æ–­é“¾å¼è°ƒç”¨
- [ ] Agent ä¸å­˜åœ¨çš„æƒ…å†µï¼ŒéªŒè¯ä¼˜é›…é™çº§

**æ¨¡å¼åˆ‡æ¢**ï¼š
- [ ] å• agent â†’ é“¾å¼ï¼ŒéªŒè¯é…ç½®ä¿å­˜
- [ ] é“¾å¼ â†’ å• agentï¼ŒéªŒè¯é“¾é…ç½®æ¸…é™¤
- [ ] åå¤åˆ‡æ¢ï¼ŒéªŒè¯æ•°æ®ä¸€è‡´æ€§

**UI äº¤äº’**ï¼š
- [ ] é…ç½®å¯¹è¯æ¡†çš„æ·»åŠ /åˆ é™¤/æ’åº
- [ ] æ‹–æ‹½æ’åºåŠŸèƒ½
- [ ] AppBar æ˜¾ç¤ºæ­£ç¡®çš„æ¨¡å¼å’ŒçŠ¶æ€
- [ ] MessageBubble æ˜¾ç¤º Agent æ ‡ç­¾

### å…¼å®¹æ€§æµ‹è¯•

**å‘åå…¼å®¹**ï¼š
- [ ] æ‰“å¼€æ—§çš„å• agent ä¼šè¯ï¼ŒéªŒè¯æ­£å¸¸å·¥ä½œ
- [ ] æ—§ä¼šè¯åˆ‡æ¢åˆ°é“¾æ¨¡å¼ï¼ŒéªŒè¯è¿ç§»æˆåŠŸ
- [ ] é“¾æ¨¡å¼åˆ‡æ¢å›å• agentï¼ŒéªŒè¯ä¸å½±å“æ—§æ•°æ®

**æ•°æ®æŒä¹…åŒ–**ï¼š
- [ ] é…ç½® agent é“¾åé‡å¯åº”ç”¨ï¼ŒéªŒè¯é…ç½®ä¿å­˜
- [ ] ä¿®æ”¹é“¾é…ç½®ï¼ŒéªŒè¯æ›´æ–°ç”Ÿæ•ˆ
- [ ] åˆ é™¤èŠ‚ç‚¹ï¼ŒéªŒè¯æŒä¹…åŒ–æ­£ç¡®

### æ€§èƒ½æµ‹è¯•

**æµå¼å“åº”**ï¼š
- [ ] éªŒè¯æ¯ä¸ª agent çš„è¾“å‡ºå®æ—¶æ˜¾ç¤º
- [ ] é•¿æ–‡æœ¬è¾“å‡ºæ—¶ UI ä¸å¡é¡¿
- [ ] å¿«é€Ÿåˆ‡æ¢ä¼šè¯ï¼ŒéªŒè¯æ— å†…å­˜æ³„æ¼

**å¤§è§„æ¨¡æµ‹è¯•**ï¼š
- [ ] é…ç½® 5+ ä¸ª agentï¼ŒéªŒè¯æ‰§è¡Œç¨³å®š
- [ ] é•¿å¯¹è¯å†å²ï¼ˆ100+ æ¶ˆæ¯ï¼‰ï¼ŒéªŒè¯æ€§èƒ½
- [ ] å¤§é‡æ–‡ä»¶é™„ä»¶ï¼ŒéªŒè¯ç¬¬ä¸€ä¸ª agent æ­£ç¡®å¤„ç†

### è¾¹ç•Œæµ‹è¯•

**å¼‚å¸¸æƒ…å†µ**ï¼š
- [ ] ç©ºé“¾é…ç½®ï¼ˆåº”æç¤ºé”™è¯¯ï¼‰
- [ ] å•èŠ‚ç‚¹é“¾ï¼ˆç­‰åŒäºå• agentï¼‰
- [ ] Agent ä¸å­˜åœ¨ï¼ˆä¼˜é›…é™çº§ï¼‰
- [ ] ç½‘ç»œé”™è¯¯ï¼ˆé”™è¯¯æç¤ºæ¸…æ™°ï¼‰
- [ ] ä¸Šä¸‹æ–‡æ¨¡å¼åˆ‡æ¢ï¼ˆéªŒè¯æ¶ˆæ¯æ„å»ºæ­£ç¡®ï¼‰

---

## æ–‡ä»¶æ¸…å•

### æ–°å¢æ–‡ä»¶ï¼ˆ2ä¸ªï¼‰

1. **`lib/plugins/agent_chat/models/agent_chain_node.dart`** (100 è¡Œ)
   - AgentContextMode æšä¸¾
   - AgentChainNode ç±»
   - åºåˆ—åŒ–/ååºåˆ—åŒ–

2. **`lib/plugins/agent_chat/screens/chat_screen/components/agent_chain_config_dialog.dart`** (350 è¡Œ)
   - Agent é“¾é…ç½®å¯¹è¯æ¡†
   - èŠ‚ç‚¹å¢åˆ æ”¹
   - æ‹–æ‹½æ’åº UI

### ä¿®æ”¹æ–‡ä»¶ï¼ˆ5ä¸ªï¼‰

1. **`lib/plugins/agent_chat/models/conversation.dart`** (+30 è¡Œ)
   - æ·»åŠ  agentChain å­—æ®µ
   - æ·»åŠ  isChainMode, effectiveAgentIds getter
   - ä¿®æ”¹åºåˆ—åŒ–æ–¹æ³•

2. **`lib/plugins/agent_chat/models/chat_message.dart`** (+20 è¡Œ)
   - æ·»åŠ  generatedByAgentId, chainStepIndex å­—æ®µ
   - ä¿®æ”¹å·¥å‚æ–¹æ³•å’Œåºåˆ—åŒ–

3. **`lib/plugins/agent_chat/controllers/chat_controller.dart`** (+250 è¡Œ)
   - æ ¸å¿ƒé“¾å¼æ‰§è¡Œé€»è¾‘
   - ä¸Šä¸‹æ–‡æ„å»ºé€»è¾‘
   - æ¨¡å¼åˆ‡æ¢æ–¹æ³•

4. **`lib/plugins/agent_chat/screens/chat_screen/chat_screen.dart`** (+120 è¡Œ)
   - AppBar æ˜¾ç¤ºå¢å¼º
   - Agent é€‰æ‹©å™¨ä¿®æ”¹
   - getAgentName å›è°ƒ

5. **`lib/plugins/agent_chat/screens/chat_screen/components/message_bubble.dart`** (+40 è¡Œ)
   - Agent æ ‡ç­¾æ˜¾ç¤º
   - getAgentName å‚æ•°

**æ€»ä»£ç é‡**ï¼šçº¦ **910 è¡Œ**

---

## ç‰ˆæœ¬å†å²

| ç‰ˆæœ¬ | æ—¥æœŸ | è¯´æ˜ |
|------|------|------|
| 1.0 | 2025-12-21 | åˆå§‹ç‰ˆæœ¬ï¼Œå®Œæ•´å®ç° Agent é“¾å¼è°ƒç”¨åŠŸèƒ½ |

---

## å‚è€ƒèµ„æ–™

- [OpenAI Chat Completions API](https://platform.openai.com/docs/api-reference/chat)
- [Flutter ReorderableListView](https://api.flutter.dev/flutter/widgets/ReorderableListView-class.html)
- [åŸå§‹éœ€æ±‚è®¨è®ºè®°å½•](#ç”¨æˆ·éœ€æ±‚)

---

**æ–‡æ¡£ç»´æŠ¤è€…**ï¼šAI Agent
**æœ€åæ›´æ–°**ï¼š2025-12-21
