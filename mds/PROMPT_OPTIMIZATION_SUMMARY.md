# Prompt ä¼˜åŒ–æ€»ç»“

æœ¬æ¬¡æ›´æ–°ä¸»è¦é’ˆå¯¹ AI Agent å·¥å…·è°ƒç”¨çš„ Prompt è¿›è¡Œäº†ä¸‰é¡¹é‡è¦ä¼˜åŒ–ï¼Œä»¥è§£å†³ä»£ç ç”Ÿæˆä¸­çš„å¸¸è§é—®é¢˜ã€‚

## ğŸ“ æ”¹åŠ¨æ¦‚è¿°

### 1. âœ… å¢åŠ æ’ä»¶åˆ«åå…³é”®è¯æ˜ å°„

**æ”¹åŠ¨æ–‡ä»¶**ï¼š`lib/plugins/agent_chat/services/tool_config_manager.dart`

**æ–°å¢å†…å®¹**ï¼š
- æ·»åŠ äº† `_pluginAliases` é™æ€å¸¸é‡ï¼ŒåŒ…å«18ä¸ªæ’ä»¶çš„ä¸­æ–‡åˆ«åæ˜ å°„
- æ·»åŠ äº† `getPluginAliases()` æ–¹æ³•è·å–åˆ«åæ˜ å°„
- æ·»åŠ äº† `generatePluginAliasesPrompt()` æ–¹æ³•ç”Ÿæˆåˆ«åè¯´æ˜

**åˆ«åæ˜ å°„ç¤ºä¾‹**ï¼š
```dart
'bill': ['è´¦å•', 'è®°è´¦', 'è´¦æœ¬', 'è´¢åŠ¡', 'æ¶ˆè´¹', 'æ”¯å‡º', 'æ”¶å…¥', 'èŠ±é”€'],
'chat': ['èŠå¤©', 'é¢‘é“', 'æ¶ˆæ¯', 'å¯¹è¯', 'ä¼šè¯'],
'diary': ['æ—¥è®°', 'æ—¥å¿—', 'è®°å½•'],
'todo': ['ä»»åŠ¡', 'å¾…åŠ', 'æ¸…å•', 'äº‹é¡¹', 'è®¡åˆ’'],
// ... æ›´å¤šæ’ä»¶
```

**æ•ˆæœ**ï¼š
- ç”¨æˆ·è¯´"å¸®æˆ‘è®°ä¸€ç¬”è´¦" â†’ AI è‡ªåŠ¨è¯†åˆ«ä¸º `bill` æ’ä»¶
- ç”¨æˆ·è¯´"æŸ¥çœ‹ä»Šå¤©çš„ä»»åŠ¡" â†’ AI è‡ªåŠ¨è¯†åˆ«ä¸º `todo` æ’ä»¶
- ç”¨æˆ·è¯´"ç»™é¢‘é“å‘æ¶ˆæ¯" â†’ AI è‡ªåŠ¨è¯†åˆ«ä¸º `chat` æ’ä»¶

---

### 2. âœ… ä¼˜åŒ– Promptï¼Œå¢å¼ºç¦æ­¢ç¡¬ç¼–ç æ—¥æœŸçš„è¯´æ˜

**æ”¹åŠ¨æ–‡ä»¶**ï¼š`lib/plugins/agent_chat/services/tool_service.dart`

**æ–°å¢/ä¿®æ”¹çš„ Prompt å†…å®¹**ï¼š

#### åœ¨é‡è¦æç¤ºéƒ¨åˆ†ï¼š
```markdown
### âš ï¸ é‡è¦æç¤º
1. **å½“å‰æ—¶é—´**ï¼šä½ æ— æ³•æ„ŸçŸ¥æ—¶é—´æµé€ï¼Œ**ç»å¯¹ç¦æ­¢**ç¡¬ç¼–ç æ—¥æœŸæ—¶é—´å­—ç¬¦ä¸²ï¼ˆå¦‚ "2025-01-15"ã€"ä»Šå¤©æ˜¯1æœˆ15æ—¥"ï¼‰

### ğŸš« ä¸¥æ ¼ç¦æ­¢çš„è¡Œä¸º
1. **ç¦æ­¢ç¡¬ç¼–ç æ—¥æœŸæ—¶é—´**ï¼š
   - âŒ é”™è¯¯ï¼š`const date = "2025-01-15"` æˆ– `const content = "ä»Šå¤©æ˜¯2025å¹´1æœˆ15æ—¥"`
   - âœ… æ­£ç¡®ï¼š`const time = await Memento.system.getCurrentTime(); const date = \`${time.year}-${String(time.month).padStart(2, '0')}-${String(time.day).padStart(2, '0')}\``
```

#### åœ¨ç³»ç»Ÿ API éƒ¨åˆ†ï¼š
```markdown
### ç³»ç»Ÿ APIï¼ˆåœ¨ JavaScript ä»£ç ä¸­ç›´æ¥è°ƒç”¨ï¼‰
- `await Memento.system.getCurrentTime()` - **å¿…é¡»ä½¿ç”¨æ­¤APIè·å–å½“å‰æ—¶é—´**
  è¿”å› `{timestamp, datetime, year, month, day, hour, minute, second, weekday, weekdayName}`
```

#### åœ¨æ³¨æ„äº‹é¡¹éƒ¨åˆ†ï¼š
```markdown
1. **ğŸš« ç»å¯¹ç¦æ­¢ç¡¬ç¼–ç æ—¥æœŸæ—¶é—´**ï¼šä»»ä½•æ¶‰åŠæ—¥æœŸæ—¶é—´çš„ä»£ç ï¼Œå¿…é¡»ä½¿ç”¨ `await Memento.system.getCurrentTime()` è·å–å½“å‰æ—¶é—´
   - ç”Ÿæˆæ—¥è®°å†…å®¹æ—¶ï¼Œä½¿ç”¨ç³»ç»ŸAPIè·å–çš„çœŸå®æ—¥æœŸï¼Œä¸è¦ä½¿ç”¨ä½ çŸ¥è¯†ä¸­çš„æ—¥æœŸ
   - åˆ›å»ºä»»åŠ¡ã€è´¦å•ç­‰éœ€è¦æ—¥æœŸçš„æ“ä½œï¼Œéƒ½å¿…é¡»å…ˆè°ƒç”¨ç³»ç»ŸAPI
```

**æ•ˆæœ**ï¼š
- é˜²æ­¢AIåœ¨ç”Ÿæˆæ—¥è®°å†…å®¹æ—¶ä½¿ç”¨é”™è¯¯çš„æ—¥æœŸ
- ç¡®ä¿æ‰€æœ‰æ¶‰åŠæ—¥æœŸçš„æ“ä½œéƒ½ä½¿ç”¨å®æ—¶è·å–çš„ç³»ç»Ÿæ—¶é—´
- é¿å…å‡ºç° "ä»Šå¤©æ˜¯2025å¹´1æœˆ15æ—¥" è¿™æ ·çš„ç¡¬ç¼–ç æ—¥æœŸ

---

### 3. âœ… ç¦æ­¢å ä½ç¬¦å˜é‡ï¼Œä¼˜å…ˆéå†å·²æœ‰æ•°æ®

**æ”¹åŠ¨æ–‡ä»¶**ï¼š`lib/plugins/agent_chat/services/tool_service.dart`

**æ–°å¢çš„ Prompt è§„åˆ™**ï¼š

```markdown
### ğŸš« ä¸¥æ ¼ç¦æ­¢çš„è¡Œä¸º
2. **ç¦æ­¢ä½¿ç”¨å ä½ç¬¦å˜é‡**ï¼š
   - âŒ é”™è¯¯ï¼š`const channelId = "your_channel_id"` æˆ– `accountId: "è¯·å¡«å…¥è´¦æˆ·ID"`
   - âœ… æ­£ç¡®ï¼šå…ˆæŸ¥è¯¢è·å–çœŸå®æ•°æ®ï¼Œç„¶åä½¿ç”¨å®é™…çš„ID
   - âœ… ç¤ºä¾‹ï¼š`const channels = await Memento.plugins.chat.getChannels(); const firstChannel = channels[0]; await Memento.plugins.chat.sendMessage({channelId: firstChannel.id, content: "æ¶ˆæ¯å†…å®¹"})`
```

**å¤„ç†ç­–ç•¥**ï¼š
```markdown
2. **ğŸš« ç»å¯¹ç¦æ­¢ä½¿ç”¨å ä½ç¬¦**ï¼šä¸å…è®¸ä½¿ç”¨ "your_xxx_id"ã€"è¯·å¡«å…¥xxx" ç­‰å ä½ç¬¦
   - å¦‚æœç”¨æˆ·æœªæŒ‡å®šIDï¼Œä¼˜å…ˆéå†å·²æœ‰æ•°æ®é€‰æ‹©åˆé€‚çš„ï¼ˆç¬¬ä¸€ä¸ªã€æœ€è¿‘çš„ã€ç¬¦åˆæ¡ä»¶çš„ï¼‰
   - å¦‚æœæ²¡æœ‰æ•°æ®ï¼Œåº”è¯¥å…ˆåˆ›å»ºæ•°æ®å†æ‰§è¡Œæ“ä½œï¼Œæˆ–è€…è¿”å›æ˜ç¡®çš„é”™è¯¯æç¤º
```

**æ•ˆæœ**ï¼š
- ä¸å†ç”Ÿæˆ `channelId: "your_channel_id"` è¿™æ ·çš„å ä½ç¬¦ä»£ç 
- è‡ªåŠ¨éå†å·²æœ‰æ•°æ®ï¼Œé€‰æ‹©ç¬¬ä¸€ä¸ªæˆ–æœ€åˆé€‚çš„
- å¦‚æœæ²¡æœ‰æ•°æ®ï¼Œä¼šå…ˆåˆ›å»ºæˆ–è¿”å›æ˜ç¡®é”™è¯¯

---

## ğŸ”„ ä¿®æ”¹çš„æ–‡ä»¶æ¸…å•

1. **lib/plugins/agent_chat/services/tool_config_manager.dart**
   - æ·»åŠ  `_pluginAliases` å¸¸é‡ï¼ˆ47-67è¡Œï¼‰
   - æ·»åŠ  `getPluginAliases()` æ–¹æ³•ï¼ˆ561-564è¡Œï¼‰
   - æ·»åŠ  `generatePluginAliasesPrompt()` æ–¹æ³•ï¼ˆ566-582è¡Œï¼‰

2. **lib/plugins/agent_chat/services/tool_service.dart**
   - ä¿®æ”¹ `_generateToolListPrompt()` æ–¹æ³•
     - å¢å¼ºæ—¥æœŸç¦æ­¢è¯´æ˜ï¼ˆ204-224è¡Œï¼‰
     - æ·»åŠ æ’ä»¶åˆ«åæ˜ å°„ï¼ˆ255è¡Œï¼‰
     - æ›´æ–°æ³¨æ„äº‹é¡¹ï¼ˆ343-353è¡Œï¼‰
   - ä¿®æ”¹ `_getFallbackToolPrompt()` æ–¹æ³•ï¼ˆ358-441è¡Œï¼‰
   - ä¿®æ”¹ `getToolDetailPrompt()` æ–¹æ³•
     - æ·»åŠ ä¸¥æ ¼ç¦æ­¢è§„åˆ™ï¼ˆ541-551è¡Œï¼‰
     - æ·»åŠ æ’ä»¶åˆ«åæ˜ å°„ï¼ˆ567è¡Œï¼‰

3. **test/tool_service_prompt_test.dart**ï¼ˆæ–°å»ºï¼‰
   - æ·»åŠ å•å…ƒæµ‹è¯•éªŒè¯æ‰€æœ‰æ”¹åŠ¨

---

## âœ… æµ‹è¯•éªŒè¯

åˆ›å»ºäº†å®Œæ•´çš„æµ‹è¯•å¥—ä»¶ï¼Œæ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼š
```bash
flutter test test/tool_service_prompt_test.dart
# ç»“æœï¼š7ä¸ªæµ‹è¯•å…¨éƒ¨é€šè¿‡ âœ“
```

æµ‹è¯•è¦†ç›–ï¼š
- âœ… æ’ä»¶åˆ«åæ˜ å°„åŒ…å«æ‰€æœ‰ä¸»è¦æ’ä»¶
- âœ… æ’ä»¶åˆ«åPromptæ ¼å¼æ­£ç¡®
- âœ… PromptåŒ…å«ç¦æ­¢ç¡¬ç¼–ç æ—¥æœŸçš„è­¦å‘Š
- âœ… PromptåŒ…å«æ­£ç¡®å’Œé”™è¯¯çš„ç¤ºä¾‹
- âœ… è¯¦ç»†å·¥å…·PromptåŒ…å«æ’ä»¶åˆ«åæ˜ å°„
- âœ… Promptå¼ºè°ƒç³»ç»ŸAPIçš„ä½¿ç”¨
- âœ… PromptåŒ…å«é¿å…å ä½ç¬¦çš„ç­–ç•¥

---

## ğŸ“– ä½¿ç”¨ç¤ºä¾‹

### ç¤ºä¾‹1ï¼šç”Ÿæˆæ—¥è®°ï¼ˆæ­£ç¡®ä½¿ç”¨ç³»ç»Ÿæ—¶é—´ï¼‰

**ç”¨æˆ·è¾“å…¥**ï¼š"å¸®æˆ‘å†™ä¸€ç¯‡æ—¥è®°"

**AIç”Ÿæˆçš„ä»£ç **ï¼ˆæ­£ç¡®ï¼‰ï¼š
```javascript
const time = await Memento.system.getCurrentTime();
const date = `${time.year}-${String(time.month).padStart(2, '0')}-${String(time.day).padStart(2, '0')}`;
const content = `ä»Šå¤©æ˜¯${time.year}å¹´${time.month}æœˆ${time.day}æ—¥ï¼Œæ˜ŸæœŸ${time.weekdayName}...`;
const diary = await Memento.plugins.diary.createEntry({
  date: date,
  content: content
});
setResult(`æ—¥è®°å·²åˆ›å»ºï¼š${date}`);
return `æ—¥è®°å·²åˆ›å»ºï¼š${date}`;
```

### ç¤ºä¾‹2ï¼šå‘é€æ¶ˆæ¯ï¼ˆè‡ªåŠ¨é€‰æ‹©é¢‘é“ï¼‰

**ç”¨æˆ·è¾“å…¥**ï¼š"ç»™é¢‘é“å‘ä¸ªæ¶ˆæ¯è¯´æµ‹è¯•"

**AIç”Ÿæˆçš„ä»£ç **ï¼ˆæ­£ç¡®ï¼‰ï¼š
```javascript
const channels = await Memento.plugins.chat.getChannels();
if (channels.length === 0) {
  setResult('é”™è¯¯ï¼šæ²¡æœ‰å¯ç”¨é¢‘é“');
  return 'é”™è¯¯ï¼šæ²¡æœ‰å¯ç”¨é¢‘é“';
}
const firstChannel = channels[0];
const message = await Memento.plugins.chat.sendMessage({
  channelId: firstChannel.id,
  content: 'æµ‹è¯•'
});
setResult(`æ¶ˆæ¯å·²å‘é€åˆ°é¢‘é“ï¼š${firstChannel.name}`);
return `æ¶ˆæ¯å·²å‘é€åˆ°é¢‘é“ï¼š${firstChannel.name}`;
```

### ç¤ºä¾‹3ï¼šè®°è´¦ï¼ˆè‡ªåŠ¨é€‰æ‹©è´¦æˆ·ï¼‰

**ç”¨æˆ·è¾“å…¥**ï¼š"å¸®æˆ‘è®°ä¸€ç¬”æ”¯å‡ºï¼Œåƒé¥­èŠ±äº†50å—"

**AIç”Ÿæˆçš„ä»£ç **ï¼ˆæ­£ç¡®ï¼‰ï¼š
```javascript
const time = await Memento.system.getCurrentTime();
const today = `${time.year}-${String(time.month).padStart(2, '0')}-${String(time.day).padStart(2, '0')}`;
const accounts = await Memento.plugins.bill.getAccounts({});
if (accounts.length === 0) {
  setResult('é”™è¯¯ï¼šæ²¡æœ‰å¯ç”¨è´¦æˆ·ï¼Œè¯·å…ˆåˆ›å»ºè´¦æˆ·');
  return 'é”™è¯¯ï¼šæ²¡æœ‰å¯ç”¨è´¦æˆ·ï¼Œè¯·å…ˆåˆ›å»ºè´¦æˆ·';
}
const firstAccount = accounts[0];
const bill = await Memento.plugins.bill.createBill({
  accountId: firstAccount.id,
  amount: -50,
  category: 'é¤é¥®',
  title: 'åƒé¥­',
  date: today
});
setResult(`å·²è®°å½•æ”¯å‡ºï¼š50å…ƒï¼Œè´¦æˆ·ï¼š${firstAccount.title}`);
return `å·²è®°å½•æ”¯å‡ºï¼š50å…ƒï¼Œè´¦æˆ·ï¼š${firstAccount.title}`;
```

---

## ğŸ¯ é¢„æœŸæ”¹è¿›æ•ˆæœ

1. **æ—¥æœŸå‡†ç¡®æ€§**ï¼šAIç”Ÿæˆçš„æ—¥è®°ã€ä»»åŠ¡ã€è´¦å•ç­‰å†…å®¹å°†ä½¿ç”¨çœŸå®çš„å½“å‰æ—¥æœŸï¼Œè€Œä¸æ˜¯é”™è¯¯çš„ç¡¬ç¼–ç æ—¥æœŸ
2. **ä»£ç å¯æ‰§è¡Œæ€§**ï¼šä¸å†å‡ºç° `your_channel_id` ç­‰å ä½ç¬¦ï¼Œç”Ÿæˆçš„ä»£ç å¯ä»¥ç›´æ¥æ‰§è¡Œ
3. **ç”¨æˆ·ä½“éªŒ**ï¼šç”¨æˆ·ä½¿ç”¨è‡ªç„¶è¯­è¨€ï¼ˆå¦‚"è®°è´¦"ã€"èŠå¤©"ï¼‰æ—¶ï¼ŒAIèƒ½å‡†ç¡®è¯†åˆ«å¯¹åº”çš„æ’ä»¶
4. **æ™ºèƒ½é€‰æ‹©**ï¼šå½“ç”¨æˆ·æœªæŒ‡å®šIDæ—¶ï¼ŒAIä¼šè‡ªåŠ¨é€‰æ‹©ç¬¬ä¸€ä¸ªæˆ–æœ€åˆé€‚çš„æ•°æ®

---

## ğŸ“Œ æ³¨æ„äº‹é¡¹

1. è¿™äº›æ”¹åŠ¨ä¸»è¦å½±å“AIç”Ÿæˆçš„JavaScriptä»£ç è´¨é‡ï¼Œä¸å½±å“ç°æœ‰åŠŸèƒ½
2. å·²æ·»åŠ å®Œæ•´çš„å•å…ƒæµ‹è¯•ï¼Œç¡®ä¿æ”¹åŠ¨ä¸ä¼šç ´åç°æœ‰åŠŸèƒ½
3. æ‰€æœ‰æ”¹åŠ¨å‘åå…¼å®¹ï¼Œä¸éœ€è¦ä¿®æ”¹å…¶ä»–ä»£ç 

---

**æ›´æ–°æ—¥æœŸ**ï¼š2025-11-19
**æµ‹è¯•çŠ¶æ€**ï¼šâœ… å…¨éƒ¨é€šè¿‡
