# Memento Sync Server - Admin Panel

## 文件说明

### 静态资源
- `index.html` - 管理后台主页面
- `app.js` - Vue 应用主逻辑
- `style.css` - 样式文件
- `vue.global.prod.js` - Vue 3.4.21 生产版本（本地文件，无需网络）

### Vue.js 版本信息
- **版本**: 3.4.21
- **类型**: 生产版本（压缩优化）
- **来源**: jsdelivr CDN
- **大小**: 145KB
- **加载方式**: 本地加载（离线可用）

## 功能特性

### 核心功能
- ✅ 完全离线可用（无需依赖外部 CDN）
- ✅ 登录认证管理
- ✅ 文件树形展示
- ✅ 文件上传/下载/删除
- ✅ 数据导出（ZIP）
- ✅ 服务器状态监控
- ✅ 响应式设计

### API 访问控制 🆕
- ✅ 实时查看 API 启用/禁用状态
- ✅ 概览页快速查看 API 状态（点击跳转到设置页）
- ✅ 启用 API 访问（允许客户端同步）
- ✅ 禁用 API 访问（阻止所有客户端请求）
- ✅ 手动刷新 API 状态
- ✅ 双重确认机制（禁用时）
- ✅ 活动记录（记录启用/禁用操作）

## API 端点说明

### 认证相关
- `POST /api/v1/auth/login` - 管理员登录
- `POST /api/v1/auth/enable-api` - 启用 API 访问
- `POST /api/v1/auth/disable-api` - 禁用 API 访问
- `GET /api/v1/auth/api-status` - 查询 API 状态

### 数据管理
- `GET /api/v1/sync/list` - 获取文件列表
- `GET /api/v1/sync/pull/:path` - 下载文件
- `DELETE /api/v1/sync/delete/:path` - 删除文件
- `POST /api/v1/sync/export` - 导出所有数据为 ZIP
- `GET /api/v1/sync/download/:filename` - 下载导出的 ZIP

### 系统状态
- `GET /health` - 健康检查

## 使用指南

### 登录
1. 访问管理后台页面
2. 输入管理员凭据（默认: admin / admin123）
3. 输入服务器地址（默认: http://localhost:8080）
4. 点击登录

### 查看概览
- **同步文件数**: 显示服务器上的文件总数
- **总存储大小**: 显示所有文件占用的空间
- **服务器状态**: 实时显示服务器在线/离线状态
- **API 访问**: 显示 API 当前状态（点击可跳转到设置页）

### 管理文件
1. 切换到"文件管理"标签
2. 浏览树形结构的文件列表
3. 点击文件夹展开/折叠子项
4. 对文件执行操作：
   - **下载**: 下载单个文件
   - **删除**: 删除单个文件（需确认）

### 控制 API 访问
1. 切换到"操作"标签
2. 查看当前 API 状态：
   - 🟢 已启用：客户端可以正常同步
   - 🔴 已禁用：所有客户端请求将被拒绝
3. 操作选项：
   - **启用 API 访问**:
     - 需要输入加密密钥（从 Memento 客户端获取）
     - 密钥格式：Base64 编码，长度 44 个字符
     - 客户端路径：设置 > 开发者选项 > 同步密钥
     - 如果客户端尚未启用同步，请先在客户端启用
   - **禁用 API 访问**: 阻止所有同步请求（需双重确认）
   - **刷新状态**: 重新从服务器获取最新状态

### 获取加密密钥

**方法 1 - 从客户端获取**：
1. 打开 Memento 客户端应用
2. 进入 "设置" > "开发者选项"
3. 找到 "同步密钥" 或 "加密密钥"
4. 复制密钥（44 个字符的 Base64 字符串）

**方法 2 - 首次同步时生成**：
1. 在客户端首次启用 WebDAV 同步
2. 客户端会自动生成并保存加密密钥
3. 按照方法 1 获取生成的密钥

### 数据操作
1. 切换到"操作"标签
2. 可用操作：
   - **导出数据**: 将所有文件打包为 ZIP 下载
   - **清空服务器数据**: 删除所有同步文件（需双重确认）

## 安全提示

⚠️ **重要警告**：
1. **加密密钥安全**：
   - 加密密钥是保护用户数据的唯一凭证
   - 请妥善保管，不要泄露给未授权人员
   - 密钥丢失将导致所有加密数据无法解密
   - 建议定期备份密钥到安全位置
2. **禁用 API** 会导致所有客户端无法同步数据，请谨慎操作
3. **清空服务器数据** 是不可逆操作，请确保已备份重要数据
4. **导出数据** 会在服务器上生成临时 ZIP 文件，建议定期清理

### 加密机制说明

Memento 使用端到端加密保护用户数据：
- 客户端生成 32 字节（256 位）AES 加密密钥
- 所有数据在客户端加密后再上传到服务器
- 服务器仅存储加密数据，无法读取明文内容
- 管理后台需要密钥才能启用 API 访问功能

## 更新 Vue.js

如需更新到新版本，执行：

```bash
# 下载新版本（替换版本号）
curl -o vue.global.prod.js "https://cdn.jsdelivr.net/npm/vue@3.4.21/dist/vue.global.prod.js"

# 或使用 wget
wget -O vue.global.prod.js "https://cdn.jsdelivr.net/npm/vue@3.4.21/dist/vue.global.prod.js"
```

## 技术栈

- **前端框架**: Vue 3 Composition API
- **UI 风格**: 现代简洁设计
- **状态管理**: Vue Reactive API
- **网络请求**: Fetch API
- **认证方式**: JWT Bearer Token

## 更新日志

### v1.1.1 (2025-12-11)
- 🐛 修复 API 状态字段名称（`api_enabled`）
- 🐛 修复 enable-api 缺少加密密钥的问题
- ✨ 添加加密密钥输入提示和验证
- 📝 完善加密机制说明文档
- 🎨 优化 UI 提示信息

### v1.1.0 (2025-12-11)
- ✨ 新增 API 访问控制功能
- ✨ 概览页显示 API 状态卡片
- 🎨 优化按钮样式和交互体验
- 📝 完善文档说明

### v1.0.0
- 🎉 初始版本发布
- ✨ 基础管理功能
- ✨ 文件管理和导出
- ✨ 本地 Vue.js 加载
