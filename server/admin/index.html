<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Memento Sync Server - Admin</title>
    <!-- Vue 3 æœ¬åœ°åŠ è½½ -->
    <script src="vue.global.prod.js"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="app">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <h1>Memento Sync Server</h1>
                <div class="header-actions" v-if="isLoggedIn">
                    <span class="user-info">{{ currentUser }}</span>
                    <button class="btn btn-outline" @click="logout">é€€å‡ºç™»å½•</button>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Login Form -->
            <div v-if="!isLoggedIn" class="login-container">
                <div class="card login-card">
                    <h2>ç®¡ç†å‘˜ç™»å½•</h2>
                    <div class="login-tips">
                        <small>é»˜è®¤å‡­æ®: admin / admin123</small>
                    </div>
                    <form @submit.prevent="login">
                        <div class="form-group">
                            <label for="username">ç”¨æˆ·å</label>
                            <input
                                type="text"
                                id="username"
                                v-model="loginForm.username"
                                required
                                placeholder="è¯·è¾“å…¥ç”¨æˆ·å"
                            >
                        </div>
                        <div class="form-group">
                            <label for="password">å¯†ç </label>
                            <input
                                type="password"
                                id="password"
                                v-model="loginForm.password"
                                required
                                placeholder="è¯·è¾“å…¥å¯†ç "
                            >
                        </div>
                        <div class="form-group">
                            <label for="server">æœåŠ¡å™¨åœ°å€</label>
                            <input
                                type="url"
                                id="server"
                                v-model="serverUrl"
                                required
                                placeholder="http://localhost:8080"
                            >
                        </div>
                        <button type="submit" class="btn btn-primary btn-block" :disabled="loading">
                            {{ loading ? 'ç™»å½•ä¸­...' : 'ç™»å½•' }}
                        </button>
                        <p v-if="error" class="error-message">{{ error }}</p>
                    </form>
                </div>
            </div>

            <!-- Dashboard -->
            <div v-else class="dashboard">
                <!-- Tabs -->
                <div class="tabs">
                    <button
                        class="tab"
                        :class="{ active: activeTab === 'overview' }"
                        @click="activeTab = 'overview'"
                    >
                        æ¦‚è§ˆ
                    </button>
                    <button
                        class="tab"
                        :class="{ active: activeTab === 'files' }"
                        @click="activeTab = 'files'"
                    >
                        æ–‡ä»¶ç®¡ç†
                    </button>
                    <button
                        class="tab"
                        :class="{ active: activeTab === 'settings' }"
                        @click="activeTab = 'settings'"
                    >
                        æ“ä½œ
                    </button>
                </div>

                <!-- Overview Tab -->
                <div v-show="activeTab === 'overview'" class="tab-content">
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-icon">ğŸ“</div>
                            <div class="stat-info">
                                <div class="stat-value">{{ stats.totalFiles }}</div>
                                <div class="stat-label">åŒæ­¥æ–‡ä»¶æ•°</div>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">ğŸ’¾</div>
                            <div class="stat-info">
                                <div class="stat-value">{{ formatSize(stats.totalSize) }}</div>
                                <div class="stat-label">æ€»å­˜å‚¨å¤§å°</div>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">âœ…</div>
                            <div class="stat-info">
                                <div class="stat-value" :class="{ 'text-green': serverStatus === 'online' }">
                                    {{ serverStatus === 'online' ? 'åœ¨çº¿' : 'ç¦»çº¿' }}
                                </div>
                                <div class="stat-label">æœåŠ¡å™¨çŠ¶æ€</div>
                            </div>
                        </div>
                        <div class="stat-card" @click="activeTab = 'settings'">
                            <div class="stat-icon">{{ apiEnabled ? 'ğŸŸ¢' : 'ğŸ”´' }}</div>
                            <div class="stat-info">
                                <div class="stat-value" :class="{ 'text-green': apiEnabled, 'text-red': !apiEnabled }">
                                    {{ apiEnabled ? 'å·²å¯ç”¨' : 'å·²ç¦ç”¨' }}
                                </div>
                                <div class="stat-label">API è®¿é—®</div>
                            </div>
                        </div>
                    </div>

                    <!-- Recent Activity -->
                    <div class="card">
                        <h3>æœ€è¿‘æ´»åŠ¨</h3>
                        <div class="activity-list">
                            <div v-for="activity in recentActivities" :key="activity.id" class="activity-item">
                                <span class="activity-icon">{{ getActivityIcon(activity.type) }}</span>
                                <span class="activity-text">{{ activity.message }}</span>
                                <span class="activity-time">{{ formatTime(activity.time) }}</span>
                            </div>
                            <div v-if="recentActivities.length === 0" class="empty-message">
                                æš‚æ— æ´»åŠ¨è®°å½•
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Files Tab -->
                <div v-show="activeTab === 'files'" class="tab-content">
                    <div class="card">
                        <div class="card-header">
                            <h3>æ–‡ä»¶ç®¡ç†</h3>
                            <button class="btn btn-primary" @click="refreshFiles">
                                ğŸ”„ åˆ·æ–°
                            </button>
                        </div>

                        <!-- æ ‘å½¢è§†å›¾ -->
                        <div class="directory-tree">
                            <template v-if="directoryTree">
                                <tree-node
                                    :node="directoryTree"
                                    :level="0"
                                    :expanded-folders="expandedFolders"
                                    @toggle="toggleFolder"
                                    @download="downloadFile"
                                    @delete="deleteFile"
                                />
                            </template>
                            <template v-else>
                                <div class="empty-message">
                                    æš‚æ— åŒæ­¥æ–‡ä»¶
                                </div>
                            </template>
                        </div>
                    </div>
                </div>

                <!-- Settings Tab -->
                <div v-show="activeTab === 'settings'" class="tab-content">
                    <!-- API è®¿é—®æ§åˆ¶ -->
                    <div class="card">
                        <h3>API è®¿é—®æ§åˆ¶</h3>
                        <div class="api-control-section">
                            <div class="api-status-info">
                                <div class="status-indicator" :class="{ 'active': apiEnabled }">
                                    {{ apiEnabled ? 'ğŸŸ¢ å·²å¯ç”¨' : 'ğŸ”´ å·²ç¦ç”¨' }}
                                </div>
                                <p class="status-description">
                                    {{ apiEnabled ? 'API è®¿é—®å·²å¼€æ”¾ï¼Œå®¢æˆ·ç«¯å¯ä»¥æ­£å¸¸è¿›è¡Œæ•°æ®åŒæ­¥ã€‚' : 'API è®¿é—®å·²å…³é—­ï¼Œæ‰€æœ‰å®¢æˆ·ç«¯è¯·æ±‚å°†è¢«æ‹’ç»ã€‚' }}
                                </p>
                                <p class="status-description" v-if="!apiEnabled" style="margin-top: 0.5rem; color: #f59e0b;">
                                    âš ï¸ å¯ç”¨ API éœ€è¦æä¾›åŠ å¯†å¯†é’¥ï¼ˆä» Memento å®¢æˆ·ç«¯è·å–ï¼‰
                                </p>
                            </div>
                            <div class="action-buttons">
                                <button
                                    v-if="!apiEnabled"
                                    class="btn btn-success"
                                    @click="enableApi"
                                    :disabled="loading"
                                >
                                    âœ… å¯ç”¨ API è®¿é—®
                                </button>
                                <button
                                    v-if="apiEnabled"
                                    class="btn btn-danger"
                                    @click="disableApi"
                                    :disabled="loading"
                                >
                                    ğŸš« ç¦ç”¨ API è®¿é—®
                                </button>
                                <button class="btn btn-outline" @click="refreshApiStatus">
                                    ğŸ”„ åˆ·æ–°çŠ¶æ€
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- æ•°æ®æ“ä½œ -->
                    <div class="card">
                        <h3>æ•°æ®æ“ä½œ</h3>
                        <div class="action-buttons">
                            <button class="btn btn-outline" @click="exportData">
                                ğŸ“¤ å¯¼å‡ºæ•°æ®
                            </button>
                            <button class="btn btn-danger" @click="clearServerData">
                                ğŸ—‘ï¸ æ¸…ç©ºæœåŠ¡å™¨æ•°æ®
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Toast Notifications -->
        <div class="toast-container">
            <div
                v-for="toast in toasts"
                :key="toast.id"
                class="toast"
                :class="toast.type"
            >
                {{ toast.message }}
            </div>
        </div>

        <!-- Loading Overlay -->
        <div v-if="loading" class="loading-overlay">
            <div class="spinner"></div>
            <span>{{ loadingMessage }}</span>
        </div>
    </div>

    <!-- Final check before loading app.js -->
    <script>
        if (typeof Vue === 'undefined') {
            document.getElementById('app').innerHTML = `
                <div style="display: flex; justify-content: center; align-items: center; height: 100vh; flex-direction: column; text-align: center; padding: 20px;">
                    <h2 style="color: #e74c3c;">âŒ Vue æ¡†æ¶åŠ è½½å¤±è´¥</h2>
                    <p style="margin-top: 20px; color: #666;">
                        æ— æ³•åŠ è½½æœ¬åœ° Vue.js æ–‡ä»¶ã€‚å¯èƒ½åŸå› ï¼š<br>
                        â€¢ vue.global.prod.js æ–‡ä»¶ä¸å­˜åœ¨<br>
                        â€¢ æ–‡ä»¶è·¯å¾„ä¸æ­£ç¡®<br>
                        â€¢ æœåŠ¡å™¨æœªæ­£ç¡®æä¾›é™æ€æ–‡ä»¶
                    </p>
                    <p style="margin-top: 20px; color: #888;">
                        è¯·ç¡®ä¿ vue.global.prod.js åœ¨ admin ç›®å½•ä¸‹ï¼Œç„¶ååˆ·æ–°é¡µé¢ã€‚
                    </p>
                    <button onclick="location.reload()" style="margin-top: 20px; padding: 10px 20px; background: #3498db; color: white; border: none; border-radius: 5px; cursor: pointer;">
                        åˆ·æ–°é¡µé¢
                    </button>
                </div>
            `;
            throw new Error('Vue is not loaded');
        }
    </script>
    <script src="app.js"></script>
</body>
</html>
