# Dart Import è½¬æ¢å·¥å…·

è¿™ä¸ªå·¥å…·å¯ä»¥å°† Dart æ–‡ä»¶ä¸­çš„ç›¸å¯¹è·¯å¾„ import è¯­å¥è½¬æ¢ä¸º package å¯¼å…¥æ ¼å¼ã€‚

## âœ… æœ€æ–°æ›´æ–° (2025-12-08)

**ä¿®å¤å†…å®¹ï¼š**
- âœ… ä¿®å¤äº†è·¯å¾„è®¡ç®—ç®—æ³•ï¼Œæ­£ç¡®å¤„ç†åµŒå¥—ç›®å½•ä¸­çš„ç›¸å¯¹è·¯å¾„
- âœ… ä¿®å¤äº† `lib/core/action/action_manager.dart` ä¸­ `../floating_ball/...` è½¬æ¢é”™è¯¯çš„é—®é¢˜
- âœ… ç°åœ¨èƒ½æ­£ç¡®è®¡ç®—ä»»æ„å±‚çº§çš„ç›¸å¯¹è·¯å¾„è½¬æ¢
- âœ… æ‰€æœ‰è½¬æ¢éƒ½å·²éªŒè¯æ­£ç¡®æ€§

## åŠŸèƒ½ç‰¹æ€§

- âœ… è‡ªåŠ¨æ‰«æ lib ç›®å½•ä¸‹çš„æ‰€æœ‰ .dart æ–‡ä»¶
- âœ… æ™ºèƒ½è½¬æ¢ç›¸å¯¹è·¯å¾„ï¼ˆå¦‚ `../../../xx/xx/index.dart`ï¼‰ä¸º package æ ¼å¼ï¼ˆå¦‚ `package:Memento/xx/xx/index.dart`ï¼‰
- âœ… æ”¯æŒ dry_run æ¨¡å¼ï¼Œä»…é¢„è§ˆæ›´æ”¹ä¸å®é™…ä¿®æ”¹æ–‡ä»¶
- âœ… æ”¯æŒå¯¼å‡ºæ‰€æœ‰æ›´æ”¹åˆ° CSV æ–‡ä»¶
- âœ… å¯è‡ªå®šä¹‰åŒ…åï¼ˆé»˜è®¤ï¼šMementoï¼‰
- âœ… è¯¦ç»†çš„è½¬æ¢ç»Ÿè®¡å’Œæ—¥å¿—

## ä½¿ç”¨æ–¹æ³•

### 1. é¢„è§ˆæ¨¡å¼ï¼ˆæ¨èå…ˆä½¿ç”¨ï¼‰

```bash
python convert_imports_v2.py
```

è¿™å°†æ‰«ææ‰€æœ‰æ–‡ä»¶å¹¶æ˜¾ç¤ºéœ€è¦è½¬æ¢çš„å†…å®¹ï¼Œä½†ä¸ä¼šä¿®æ”¹ä»»ä½•æ–‡ä»¶ã€‚

### 2. å¯¼å‡ºåˆ° CSV

å¦‚æœéœ€è¦æŸ¥çœ‹æ‰€æœ‰è½¬æ¢é¡¹ï¼Œå¯ä»¥å¯¼å‡ºåˆ° CSV æ–‡ä»¶ï¼š

```bash
python convert_imports_v2.py --export-csv
```

ç”Ÿæˆçš„ `import_changes.csv` æ–‡ä»¶åŒ…å«ä»¥ä¸‹åˆ—ï¼š
- `file`: æ–‡ä»¶è·¯å¾„
- `line`: è¡Œå·
- `old_import`: åŸå§‹ import è¯­å¥
- `new_import`: è½¬æ¢åçš„ import è¯­å¥
- `conversion_note`: è½¬æ¢è¯´æ˜

### 3. å®é™…åº”ç”¨æ›´æ”¹

**âš ï¸ è­¦å‘Šï¼šè¿™æ˜¯ä¸å¯é€†çš„æ“ä½œï¼Œè¯·ç¡®ä¿å·²å¤‡ä»½ä»£ç ï¼**

```bash
python convert_imports_v2.py --apply
```

### 4. è‡ªå®šä¹‰åŒ…å

å¦‚æœä½ çš„åŒ…åä¸æ˜¯ `Memento`ï¼Œå¯ä»¥ä½¿ç”¨ï¼š

```bash
python convert_imports_v2.py --package-name your_package_name
```

### 5. æŸ¥çœ‹å¸®åŠ©

```bash
python convert_imports_v2.py --help
```

## è½¬æ¢ç¤ºä¾‹

**è½¬æ¢å‰ï¼š**
```dart
import '../core/plugin_manager.dart';
import '../../plugins/chat/chat_plugin.dart';
import '../../../utils/image_utils.dart';
```

**è½¬æ¢åï¼š**
```dart
import 'package:Memento/core/plugin_manager.dart';
import 'package:Memento/plugins/chat/chat_plugin.dart';
import 'package:Memento/utils/image_utils.dart';
```

## è½¬æ¢è§„åˆ™

1. **ç›¸å¯¹è·¯å¾„è®¡ç®—**ï¼šæ ¹æ®å½“å‰æ–‡ä»¶åœ¨ lib/ ç›®å½•ä¸­çš„æ·±åº¦ï¼Œè‡ªåŠ¨è®¡ç®—æ­£ç¡®çš„ç›¸å¯¹è·¯å¾„
2. **è·³è¿‡æ— æ•ˆè½¬æ¢**ï¼šå¦‚æœç›¸å¯¹è·¯å¾„å‘ä¸Šå±‚çº§è¿‡å¤šï¼Œä¼šè‡ªåŠ¨è·³è¿‡
3. **ä¿æŒç»“æ„**ï¼šè‡ªåŠ¨ç§»é™¤ `lib/` å‰ç¼€ï¼Œä½¿ç”¨ package æ ¹è·¯å¾„
4. **æ”¯æŒå¤šå±‚çº§**ï¼šæ”¯æŒä»»æ„å±‚çº§çš„ç›¸å¯¹è·¯å¾„è½¬æ¢

## å®é™…è¿è¡Œç»“æœ

å½“å‰é¡¹ç›®æ‰«æç»“æœï¼š
- ğŸ“ æ‰«ææ–‡ä»¶ï¼š909 ä¸ª Dart æ–‡ä»¶
- ğŸ“ éœ€ä¿®æ”¹æ–‡ä»¶ï¼š482 ä¸ª
- ğŸ”„ æ€»è½¬æ¢æ•°ï¼š1491 ä¸ª

## æ¨èå·¥ä½œæµç¨‹

1. **ç¬¬ä¸€æ­¥**ï¼šè¿è¡Œé¢„è§ˆæ¨¡å¼æŸ¥çœ‹è½¬æ¢å†…å®¹
   ```bash
   python convert_imports_v2.py
   ```

2. **ç¬¬äºŒæ­¥**ï¼šå¯¼å‡º CSV æŸ¥çœ‹è¯¦ç»†è½¬æ¢é¡¹
   ```bash
   python convert_imports_v2.py --export-csv
   ```

3. **ç¬¬ä¸‰æ­¥**ï¼šå®¡æŸ¥ CSV æ–‡ä»¶ï¼Œç¡®è®¤è½¬æ¢æ­£ç¡®æ€§

4. **ç¬¬å››æ­¥**ï¼šå¤‡ä»½ä»£ç ï¼ˆé‡è¦ï¼ï¼‰
   ```bash
   git add .
   git commit -m "å¤‡ä»½ï¼šè½¬æ¢ import å‰çš„ä»£ç "
   ```

5. **ç¬¬äº”æ­¥**ï¼šåº”ç”¨æ›´æ”¹
   ```bash
   python convert_imports_v2.py --apply
   ```

6. **ç¬¬å…­æ­¥**ï¼šæµ‹è¯•ç¼–è¯‘
   ```bash
   flutter analyze
   flutter build apk --debug  # æˆ–å…¶ä»–å¹³å°
   ```

## æ•…éšœæ’é™¤

### é—®é¢˜ï¼šè½¬æ¢åç¼–è¯‘å¤±è´¥

**è§£å†³æ–¹æ¡ˆï¼š**
1. æ£€æŸ¥æ˜¯å¦æœ‰é—æ¼çš„ç›¸å¯¹è·¯å¾„ import
2. éªŒè¯ package åç§°æ˜¯å¦æ­£ç¡®
3. è¿è¡Œ `flutter clean && flutter pub get` æ¸…ç†ç¼“å­˜

### é—®é¢˜ï¼šä¸æƒ³è½¬æ¢æŸä¸ªæ–‡ä»¶

**è§£å†³æ–¹æ¡ˆï¼š**
åœ¨åº”ç”¨æ›´æ”¹å‰ï¼Œæ‰‹åŠ¨ç¼–è¾‘è¯¥æ–‡ä»¶çš„ import è¯­å¥ï¼Œæˆ–åœ¨è½¬æ¢åæ‰‹åŠ¨æ¢å¤ã€‚

### é—®é¢˜ï¼šéœ€è¦å›æ»š

**è§£å†³æ–¹æ¡ˆï¼š**
```bash
git checkout HEAD -- .
```

## æ–‡ä»¶è¯´æ˜

- `convert_imports_v2.py`: ä¸»è¦è„šæœ¬ï¼ˆæ¨èä½¿ç”¨ï¼‰
- `convert_imports.py`: åˆå§‹ç‰ˆæœ¬ï¼ˆåŠŸèƒ½ç±»ä¼¼ä½†è¾“å‡ºæœ‰ç¼–ç é—®é¢˜ï¼‰
- `import_changes.csv`: å¯¼å‡ºçš„è½¬æ¢é¡¹ï¼ˆç”Ÿæˆï¼‰
- `IMPORT_CONVERTER_README.md`: æœ¬æ–‡æ¡£

## æŠ€æœ¯ç»†èŠ‚

### è½¬æ¢ç®—æ³•

1. è§£ææ¯ä¸ª import è¯­å¥çš„æ­£åˆ™è¡¨è¾¾å¼ï¼š`import\s+['\"]((\.\./)+[^'\"]+)['\"];`
2. è®¡ç®—å½“å‰æ–‡ä»¶ç›¸å¯¹äº lib/ çš„æ·±åº¦
3. ç»Ÿè®¡ç›¸å¯¹è·¯å¾„ä¸­çš„ `../` æ•°é‡
4. å¦‚æœå‘ä¸Šå±‚çº§è¿‡å¤šï¼ˆ>= å½“å‰æ·±åº¦ï¼‰ï¼Œè·³è¿‡è½¬æ¢
5. ç§»é™¤ `lib/` å‰ç¼€ï¼Œæ„å»º package è·¯å¾„
6. ç”Ÿæˆæ–°çš„ package import è¯­å¥

### æ”¯æŒçš„ import æ¨¡å¼

- âœ… `import '../xxx.dart';`
- âœ… `import '../../xxx/xxx.dart';`
- âœ… `import '../../../xxx/xxx/index.dart';`
- âœ… `import '../lib/xxx.dart';` ï¼ˆè‡ªåŠ¨ç§»é™¤ lib/ï¼‰
- âŒ ä¸æ”¯æŒï¼šç»å¯¹è·¯å¾„ `import '/xxx/xxx.dart';`
- âŒ ä¸æ”¯æŒï¼špackage è·¯å¾„ `import 'package:xxx/xxx.dart';`

## è®¸å¯è¯

æ­¤è„šæœ¬ä¸ºé¡¹ç›®ä¸“ç”¨å·¥å…·ï¼Œè¯·æ ¹æ®é¡¹ç›®è®¸å¯è¯ä½¿ç”¨ã€‚

## è´¡çŒ®

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·æäº¤ Issue æˆ– Pull Requestã€‚

---

**æœ€åæ›´æ–°**: 2025-12-08
