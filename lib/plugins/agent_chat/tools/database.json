{
  "getDatabases": {
    "title": "获取所有数据库",
    "description": "获取所有数据库的列表（不含物品记录）",
    "parameters": [],
    "returns": {
      "type": "Array",
      "description": "数据库列表，每个元素包含 id、name、description、fields 等字段"
    },
    "examples": [
      {
        "title": "获取所有数据库",
        "code": "const databases = await Memento.plugins.database.getDatabases();\nsetResult(JSON.stringify(databases, null, 2));"
      }
    ],
    "notes": "返回的数据库对象不包含 items 字段，如需获取记录请使用 getRecords",
    "enabled": true
  },
  "createDatabase": {
    "title": "创建数据库",
    "description": "创建一个新的数据库",
    "parameters": [
      {"name": "name", "type": "string", "required": true, "description": "数据库名称"},
      {"name": "description", "type": "string", "required": false, "description": "数据库描述"},
      {"name": "fieldsJson", "type": "string", "required": false, "description": "字段定义（JSON数组字符串）"}
    ],
    "returns": {
      "type": "Object",
      "description": "新创建的数据库对象"
    },
    "examples": [
      {
        "title": "创建简单数据库",
        "code": "const db = await Memento.plugins.database.createDatabase({name: '我的数据库', description: '用于记录信息'});\nsetResult(`数据库已创建: ${db.name}`);"
      },
      {
        "title": "创建带字段的数据库",
        "code": "const fields = JSON.stringify([{name: '标题', type: 'Text'}, {name: '日期', type: 'Date'}]);\nconst db = await Memento.plugins.database.createDatabase({name: '任务库', description: '任务管理', fieldsJson: fields});\nsetResult(`数据库${db.id}已创建`);"
      }
    ],
    "notes": "字段类型支持: Text, Long Text, Integer, Checkbox, Dropdown, Date, Time, Date/Time, Image, URL, Rating, Password",
    "enabled": true
  },
  "updateDatabase": {
    "title": "更新数据库",
    "description": "更新数据库的名称、描述或字段定义",
    "parameters": [
      {"name": "databaseId", "type": "string", "required": true, "description": "数据库ID"},
      {"name": "name", "type": "string", "required": false, "description": "新名称"},
      {"name": "description", "type": "string", "required": false, "description": "新描述"},
      {"name": "fieldsJson", "type": "string", "required": false, "description": "新字段定义"}
    ],
    "returns": {
      "type": "Object",
      "description": "更新后的数据库对象"
    },
    "examples": [
      {
        "title": "更新数据库名称",
        "code": "const updated = await Memento.plugins.database.updateDatabase({databaseId: 'db123', name: '新名称'});\nsetResult(`数据库已更新: ${updated.name}`);"
      }
    ],
    "notes": "仅更新提供的字段，未提供的字段保持不变",
    "enabled": true
  },
  "deleteDatabase": {
    "title": "删除数据库",
    "description": "删除指定的数据库（包括所有记录）",
    "parameters": [
      {"name": "databaseId", "type": "string", "required": true, "description": "数据库ID"}
    ],
    "returns": {
      "type": "boolean",
      "description": "删除成功返回 true"
    },
    "examples": [
      {
        "title": "删除数据库",
        "code": "const result = await Memento.plugins.database.deleteDatabase({databaseId: 'db123'});\nsetResult(result.success ? '删除成功' : (result.error || '删除失败'));"
      }
    ],
    "notes": "删除操作不可逆，会同时删除该数据库下的所有记录",
    "enabled": true
  },
  "getRecords": {
    "title": "获取记录列表",
    "description": "获取指定数据库的所有记录",
    "parameters": [
      {"name": "databaseId", "type": "string", "required": true, "description": "数据库ID"},
      {"name": "limit", "type": "number", "required": false, "description": "限制返回记录数（返回最新的N条）"}
    ],
    "returns": {
      "type": "Array",
      "description": "记录列表，每条记录包含 id、tableId、fields、createdAt、updatedAt"
    },
    "examples": [
      {
        "title": "获取所有记录",
        "code": "const records = await Memento.plugins.database.getRecords({databaseId: 'db123'});\nsetResult(`共有 ${records.length} 条记录`);"
      },
      {
        "title": "获取最新10条记录",
        "code": "const latest = await Memento.plugins.database.getRecords({databaseId: 'db123', limit: 10});\nsetResult(JSON.stringify(latest, null, 2));"
      }
    ],
    "notes": "字段数据存储在 fields 对象中，键为字段名，值为字段值",
    "enabled": true
  },
  "createRecord": {
    "title": "创建记录",
    "description": "在指定数据库中创建新记录",
    "parameters": [
      {"name": "databaseId", "type": "string", "required": true, "description": "数据库ID"},
      {"name": "fieldsJson", "type": "string", "required": true, "description": "字段数据（JSON对象字符串，键为字段名，可包含id字段用于自定义记录ID）"},
      {"name": "id", "type": "string", "required": false, "description": "记录ID(可选,不提供则自动生成)"}
    ],
    "returns": {
      "type": "Object",
      "description": "新创建的记录对象"
    },
    "examples": [
      {
        "title": "创建记录",
        "code": "const timeInfo = await Memento.system.getCurrentTime();\nconst today = `${timeInfo.year}-${String(timeInfo.month).padStart(2, '0')}-${String(timeInfo.day).padStart(2, '0')}`;\nconst fields = JSON.stringify({标题: '新任务', 日期: today, 完成: false});\nconst record = await Memento.plugins.database.createRecord({databaseId: 'db123', fieldsJson: fields});\nsetResult(`记录已创建: ${record.id}`);"
      },
      {
        "title": "使用自定义ID创建记录",
        "code": "const timeInfo = await Memento.system.getCurrentTime();\nconst today = `${timeInfo.year}-${String(timeInfo.month).padStart(2, '0')}-${String(timeInfo.day).padStart(2, '0')}`;\nconst fields = JSON.stringify({\n  标题: '项目任务',\n  日期: today,\n  完成: false,\n  优先级: '高',\n  负责人: '张三'\n});\nconst record = await Memento.plugins.database.createRecord({\n  databaseId: 'db123',\n  fieldsJson: fields,\n  id: 'rec456'\n});\nsetResult(`记录已创建，自定义ID: ${record.id}`);"
      },
      {
        "title": "在fieldsJson中包含自定义ID",
        "code": "const timeInfo = await Memento.system.getCurrentTime();\nconst today = `${timeInfo.year}-${String(timeInfo.month).padStart(2, '0')}-${String(timeInfo.day).padStart(2, '0')}`;\nconst fields = JSON.stringify({\n  id: 'rec789',\n  标题: '会议记录',\n  日期: today,\n  参与人数: 5,\n  会议类型: '项目评审'\n});\nconst record = await Memento.plugins.database.createRecord({databaseId: 'db123', fieldsJson: fields});\nsetResult(`记录已创建，ID来自fields: ${record.id}`);"
      }
    ],
    "notes": "必需参数: databaseId(数据库ID)、fieldsJson(字段数据JSON字符串);可选参数: id(自定义记录ID);支持两种自定义ID方式:1)通过id参数传入，2)在fieldsJson中包含id字段;如果不提供id会自动生成UUID;ID不能与现有记录重复;字段名必须与数据库定义的字段名匹配，字段值类型需符合字段类型定义",
    "enabled": true
  },
  "updateRecord": {
    "title": "更新记录",
    "description": "更新指定记录的字段值",
    "parameters": [
      {"name": "databaseId", "type": "string", "required": true, "description": "数据库ID"},
      {"name": "recordId", "type": "string", "required": true, "description": "记录ID"},
      {"name": "fieldsJson", "type": "string", "required": true, "description": "要更新的字段数据"}
    ],
    "returns": {
      "type": "Object",
      "description": "更新后的记录对象"
    },
    "examples": [
      {
        "title": "更新记录",
        "code": "const timeInfo = await Memento.system.getCurrentTime();\nconst today = `${timeInfo.year}-${String(timeInfo.month).padStart(2, '0')}-${String(timeInfo.day).padStart(2, '0')}`;\nconst updates = JSON.stringify({完成: true, 完成日期: today});\nconst record = await Memento.plugins.database.updateRecord({databaseId: 'db123', recordId: 'rec456', fieldsJson: updates});\nsetResult('记录已更新');"
      }
    ],
    "notes": "仅更新提供的字段，其他字段保持不变",
    "enabled": true
  },
  "deleteRecord": {
    "title": "删除记录",
    "description": "删除指定的记录",
    "parameters": [
      {"name": "databaseId", "type": "string", "required": true, "description": "数据库ID"},
      {"name": "recordId", "type": "string", "required": true, "description": "记录ID"}
    ],
    "returns": {
      "type": "boolean",
      "description": "删除成功返回 true"
    },
    "examples": [
      {
        "title": "删除记录",
        "code": "const result = await Memento.plugins.database.deleteRecord({databaseId: 'db123', recordId: 'rec456'});\nsetResult(result.success ? '删除成功' : (result.error || '删除失败'));"
      }
    ],
    "notes": "删除操作不可逆",
    "enabled": true
  },
  "query": {
    "title": "查询记录",
    "description": "根据条件查询记录",
    "parameters": [
      {"name": "databaseId", "type": "string", "required": true, "description": "数据库ID"},
      {"name": "filtersJson", "type": "string", "required": false, "description": "过滤条件（JSON对象，键值对精确匹配）"}
    ],
    "returns": {
      "type": "Array",
      "description": "符合条件的记录列表"
    },
    "examples": [
      {
        "title": "无条件查询（获取所有）",
        "code": "const all = await Memento.plugins.database.query({databaseId: 'db123'});\nsetResult(`共 ${all.length} 条记录`);"
      },
      {
        "title": "条件查询",
        "code": "const filters = JSON.stringify({完成: false, 优先级: '高'});\nconst urgent = await Memento.plugins.database.query({databaseId: 'db123', filtersJson: filters});\nsetResult(`未完成的高优先级任务: ${urgent.length} 条`);"
      }
    ],
    "notes": "过滤条件为精确匹配（字段值必须完全相等），如不提供条件则返回所有记录",
    "enabled": true
  },
  "getCount": {
    "title": "获取数量统计",
    "description": "获取数据库总数或指定数据库的记录数",
    "parameters": [
      {"name": "type", "type": "string", "required": true, "description": "统计类型：'databases'（数据库总数）或 'records'（记录数）"},
      {"name": "databaseId", "type": "string", "required": false, "description": "数据库ID（当type='records'时必须提供）"}
    ],
    "returns": {
      "type": "number",
      "description": "数量"
    },
    "examples": [
      {
        "title": "获取数据库总数",
        "code": "const count = await Memento.plugins.database.getCount({type: 'databases'});\nsetResult(`系统中有 ${count} 个数据库`);"
      },
      {
        "title": "获取记录数",
        "code": "const count = await Memento.plugins.database.getCount({type: 'records', databaseId: 'db123'});\nsetResult(`该数据库有 ${count} 条记录`);"
      }
    ],
    "notes": "type 参数只接受 'databases' 或 'records' 两个值",
    "enabled": true
  },
  "findDatabaseBy": {
    "title": "通用数据库查找",
    "description": "根据自定义条件查找数据库（支持单条/多条结果）",
    "parameters": [
      {"name": "field", "type": "string", "required": true, "description": "要匹配的字段名（如：id、name、description）"},
      {"name": "value", "type": "any", "required": true, "description": "要匹配的值"},
      {"name": "findAll", "type": "boolean", "required": false, "description": "是否返回所有匹配项（默认 false，只返回第一个）"}
    ],
    "returns": {
      "type": "Object|Array|null",
      "description": "findAll=false 时返回单个数据库对象或 null；findAll=true 时返回数据库数组"
    },
    "examples": [
      {
        "title": "根据 ID 查找数据库",
        "code": "const db = await Memento.plugins.database.findDatabaseBy({field: 'id', value: 'db123'});\nif (db) {\n  setResult(`找到数据库: ${db.name}`);\n} else {\n  setResult('未找到该数据库');\n}"
      },
      {
        "title": "查找所有包含特定描述的数据库",
        "code": "const databases = await Memento.plugins.database.findDatabaseBy({field: 'description', value: '任务管理', findAll: true});\nsetResult(`找到 ${databases.length} 个数据库`);"
      }
    ],
    "notes": "简化查找逻辑，避免手动遍历数据库列表；支持任意字段匹配",
    "enabled": true
  },
  "findDatabaseById": {
    "title": "根据ID查找数据库",
    "description": "快速根据数据库ID查找单个数据库（findDatabaseBy 的便捷方法）",
    "parameters": [
      {"name": "id", "type": "string", "required": true, "description": "数据库ID"}
    ],
    "returns": {
      "type": "Object|null",
      "description": "找到的数据库对象，未找到返回 null"
    },
    "examples": [
      {
        "title": "查找指定ID的数据库",
        "code": "const db = await Memento.plugins.database.findDatabaseById({id: 'db123'});\nif (db) {\n  setResult(`数据库名称: ${db.name}, 字段数: ${db.fields.length}`);\n} else {\n  setResult('数据库不存在');\n}"
      }
    ],
    "notes": "等价于 findDatabaseBy({field: 'id', value: id})",
    "enabled": true
  },
  "findDatabaseByName": {
    "title": "根据名称查找数据库",
    "description": "根据数据库名称查找数据库（支持精确匹配或模糊匹配）",
    "parameters": [
      {"name": "name", "type": "string", "required": true, "description": "数据库名称"},
      {"name": "fuzzy", "type": "boolean", "required": false, "description": "是否模糊匹配（默认 false，精确匹配）"},
      {"name": "findAll", "type": "boolean", "required": false, "description": "是否返回所有匹配项（默认 false）"}
    ],
    "returns": {
      "type": "Object|Array|null",
      "description": "findAll=false 时返回单个数据库或 null；findAll=true 时返回数据库数组"
    },
    "examples": [
      {
        "title": "精确匹配数据库名称",
        "code": "const db = await Memento.plugins.database.findDatabaseByName({name: '任务管理'});\nsetResult(db ? `数据库ID: ${db.id}` : '未找到');"
      },
      {
        "title": "模糊匹配查找所有包含关键词的数据库",
        "code": "const databases = await Memento.plugins.database.findDatabaseByName({name: '管理', fuzzy: true, findAll: true});\nsetResult(`找到 ${databases.length} 个包含\"管理\"的数据库`);"
      }
    ],
    "notes": "精确匹配使用 ===，模糊匹配使用 includes",
    "enabled": true
  },
  "findRecordBy": {
    "title": "通用记录查找",
    "description": "在指定数据库中根据自定义条件查找记录（支持单条/多条结果）",
    "parameters": [
      {"name": "databaseId", "type": "string", "required": true, "description": "数据库ID"},
      {"name": "field", "type": "string", "required": true, "description": "要匹配的字段名（如：id、tableId，或自定义字段名）"},
      {"name": "value", "type": "any", "required": true, "description": "要匹配的值"},
      {"name": "findAll", "type": "boolean", "required": false, "description": "是否返回所有匹配项（默认 false，只返回第一个）"}
    ],
    "returns": {
      "type": "Object|Array|null",
      "description": "findAll=false 时返回单个记录对象或 null；findAll=true 时返回记录数组"
    },
    "examples": [
      {
        "title": "根据记录ID查找",
        "code": "const record = await Memento.plugins.database.findRecordBy({databaseId: 'db123', field: 'id', value: 'rec456'});\nif (record) {\n  setResult(`找到记录: ${JSON.stringify(record.fields)}`);\n} else {\n  setResult('未找到该记录');\n}"
      },
      {
        "title": "查找所有标题为特定值的记录",
        "code": "const records = await Memento.plugins.database.findRecordBy({databaseId: 'db123', field: '标题', value: '项目任务', findAll: true});\nsetResult(`找到 ${records.length} 条标题为\"项目任务\"的记录`);"
      }
    ],
    "notes": "支持查找记录的内置字段（id、tableId）和自定义字段（存储在 fields 对象中）",
    "enabled": true
  },
  "findRecordById": {
    "title": "根据ID查找记录",
    "description": "快速根据记录ID查找单个记录（findRecordBy 的便捷方法）",
    "parameters": [
      {"name": "databaseId", "type": "string", "required": true, "description": "数据库ID"},
      {"name": "id", "type": "string", "required": true, "description": "记录ID"}
    ],
    "returns": {
      "type": "Object|null",
      "description": "找到的记录对象，未找到返回 null"
    },
    "examples": [
      {
        "title": "查找指定ID的记录",
        "code": "const record = await Memento.plugins.database.findRecordById({databaseId: 'db123', id: 'rec456'});\nif (record) {\n  setResult(`记录字段: ${JSON.stringify(record.fields, null, 2)}`);\n} else {\n  setResult('记录不存在');\n}"
      }
    ],
    "notes": "等价于 findRecordBy({databaseId, field: 'id', value: id})",
    "enabled": true
  }
}
