{
  "store_getProducts": {
    "title": "获取商品列表",
    "description": "获取所有可兑换的商品列表",
    "parameters": [],
    "returns": {
      "type": "Array",
      "description": "Product 对象数组"
    },
    "examples": [
      {
        "code": "const products = await Memento.plugins.store.getProducts({});\nsetResult(products);",
        "comment": "获取所有商品"
      }
    ],
    "notes": "返回的 Product 对象包含: id, name, description, image, stock, price, exchange_start, exchange_end, use_duration",
    "enabled": true
  },
  "store_getProduct": {
    "title": "获取商品详情",
    "description": "获取单个商品的详细信息",
    "parameters": [
      {
        "name": "productId",
        "type": "String",
        "optional": false,
        "description": "商品 ID"
      }
    ],
    "returns": {
      "type": "Object",
      "description": "Product 对象"
    },
    "examples": [
      {
        "code": "const product = await Memento.plugins.store.getProduct({productId: 'product123'});\nsetResult(product);",
        "comment": "获取指定商品信息"
      }
    ],
    "notes": "如果商品不存在会抛出异常",
    "enabled": true
  },
  "store_createProduct": {
    "title": "创建商品",
    "description": "添加新的虚拟商品到商店",
    "parameters": [
      {
        "name": "name",
        "type": "String",
        "optional": false,
        "description": "商品名称"
      },
      {
        "name": "description",
        "type": "String",
        "optional": false,
        "description": "商品描述"
      },
      {
        "name": "price",
        "type": "Number",
        "optional": false,
        "description": "价格(积分)"
      },
      {
        "name": "stock",
        "type": "Number",
        "optional": false,
        "description": "库存数量"
      },
      {
        "name": "exchangeStart",
        "type": "String",
        "optional": false,
        "description": "兑换开始时间(ISO 8601 格式)"
      },
      {
        "name": "exchangeEnd",
        "type": "String",
        "optional": false,
        "description": "兑换结束时间(ISO 8601 格式)"
      },
      {
        "name": "useDuration",
        "type": "Number",
        "optional": false,
        "description": "使用期限(天数)"
      },
      {
        "name": "id",
        "type": "String",
        "optional": true,
        "description": "自定义商品ID,如不提供则自动生成时间戳ID"
      },
      {
        "name": "image",
        "type": "String",
        "optional": true,
        "description": "商品图片路径"
      }
    ],
    "returns": {
      "type": "Object",
      "description": "创建的 Product 对象"
    },
    "examples": [
      {
        "code": "const timeInfo = await Memento.system.getCurrentTime();\nconst year = timeInfo.year;\nconst startDate = `${year}-01-01T00:00:00.000Z`;\nconst endDate = `${year}-12-31T23:59:59.999Z`;\nconst newProduct = await Memento.plugins.store.createProduct({\n  name: '迟到豁免卡',\n  description: '可豁免一次迟到',\n  price: 30,\n  stock: 20,\n  exchangeStart: startDate,\n  exchangeEnd: endDate,\n  useDuration: 60,\n  image: 'assets/late_pass.png'\n});\nsetResult(newProduct);",
        "comment": "创建今年有效的新商品(自动生成ID)"
      },
      {
        "code": "const timeInfo = await Memento.system.getCurrentTime();\nconst year = timeInfo.year;\nconst startDate = `${year}-01-01T00:00:00.000Z`;\nconst endDate = `${year}-12-31T23:59:59.999Z`;\nconst newProduct = await Memento.plugins.store.createProduct({\n  id: 'product123',\n  name: '免作业卡',\n  description: '可免除一次作业',\n  price: 50,\n  stock: 10,\n  exchangeStart: startDate,\n  exchangeEnd: endDate,\n  useDuration: 30,\n  image: 'assets/homework_pass.png'\n});\nsetResult(newProduct);",
        "comment": "使用自定义ID创建商品"
      }
    ],
    "notes": "支持自定义商品ID,如果不提供id参数则自动分配唯一ID(时间戳字符串)",
    "enabled": true
  },
  "store_updateProduct": {
    "title": "更新商品",
    "description": "更新商品的信息",
    "parameters": [
      {
        "name": "productId",
        "type": "String",
        "optional": false,
        "description": "商品 ID"
      },
      {
        "name": "name",
        "type": "String",
        "optional": false,
        "description": "商品名称"
      },
      {
        "name": "description",
        "type": "String",
        "optional": false,
        "description": "商品描述"
      },
      {
        "name": "price",
        "type": "Number",
        "optional": false,
        "description": "价格(积分)"
      },
      {
        "name": "stock",
        "type": "Number",
        "optional": false,
        "description": "库存数量"
      },
      {
        "name": "exchangeStart",
        "type": "String",
        "optional": false,
        "description": "兑换开始时间(ISO 8601 格式)"
      },
      {
        "name": "exchangeEnd",
        "type": "String",
        "optional": false,
        "description": "兑换结束时间(ISO 8601 格式)"
      },
      {
        "name": "useDuration",
        "type": "Number",
        "optional": false,
        "description": "使用期限(天数)"
      },
      {
        "name": "image",
        "type": "String",
        "optional": true,
        "description": "商品图片路径"
      }
    ],
    "returns": {
      "type": "Object",
      "description": "更新后的 Product 对象"
    },
    "examples": [
      {
        "code": "const timeInfo = await Memento.system.getCurrentTime();\nconst year = timeInfo.year;\nconst startDate = `${year}-01-01T00:00:00.000Z`;\nconst endDate = `${year}-12-31T23:59:59.999Z`;\nconst updated = await Memento.plugins.store.updateProduct({\n  productId: 'product123',\n  name: '免作业卡(升级版)',\n  description: '可免除两次作业',\n  price: 100,\n  stock: 5,\n  exchangeStart: startDate,\n  exchangeEnd: endDate,\n  useDuration: 60\n});\nsetResult(updated);",
        "comment": "更新商品信息（今年有效期）"
      }
    ],
    "notes": "如果商品不存在会抛出异常,已兑换的用户物品不受影响(使用快照机制)",
    "enabled": true
  },
  "store_deleteProduct": {
    "title": "删除商品",
    "description": "归档商品(软删除),可通过 restoreProduct 恢复",
    "parameters": [
      {
        "name": "productId",
        "type": "String",
        "optional": false,
        "description": "商品 ID"
      }
    ],
    "returns": {
      "type": "Boolean",
      "description": "总是返回 true"
    },
    "examples": [
      {
        "code": "const result = await Memento.plugins.store.deleteProduct({productId: 'product123'});\nsetResult(result);",
        "comment": "归档商品"
      }
    ],
    "notes": "商品会被移到归档列表而不是物理删除,可通过 restoreProduct 恢复",
    "enabled": true
  },
  "store_redeem": {
    "title": "兑换商品",
    "description": "使用积分兑换商品,生成用户物品",
    "parameters": [
      {
        "name": "productId",
        "type": "String",
        "optional": false,
        "description": "商品 ID"
      }
    ],
    "returns": {
      "type": "Object",
      "description": "兑换结果对象,包含 success, message, currentPoints"
    },
    "examples": [
      {
        "code": "const result = await Memento.plugins.store.redeem({productId: 'product123'});\nconst msg = result.success ? `兑换成功!剩余积分: ${result.currentPoints}` : `兑换失败: ${result.message}`;\nsetResult(msg);",
        "comment": "兑换商品"
      }
    ],
    "notes": "兑换失败的可能原因: 积分不足、库存不足、不在兑换期内。成功后会扣除积分、减少库存、生成用户物品并记录积分日志",
    "enabled": true
  },
  "store_getPoints": {
    "title": "获取当前积分",
    "description": "查询用户的当前积分余额",
    "parameters": [],
    "returns": {
      "type": "Number",
      "description": "当前积分值"
    },
    "examples": [
      {
        "code": "const points = await Memento.plugins.store.getPoints({});\nsetResult(points);",
        "comment": "查询积分余额"
      }
    ],
    "notes": "积分可通过应用内行为自动获得或手动添加",
    "enabled": true
  },
  "store_addPoints": {
    "title": "添加/扣除积分",
    "description": "手动增加或减少用户积分",
    "parameters": [
      {
        "name": "points",
        "type": "Number",
        "optional": false,
        "description": "积分值(正数增加,负数减少)"
      },
      {
        "name": "reason",
        "type": "String",
        "optional": false,
        "description": "变动原因描述"
      }
    ],
    "returns": {
      "type": "Object",
      "description": "操作结果对象,包含 success, currentPoints, message"
    },
    "examples": [
      {
        "code": "// 增加积分\nconst result1 = await Memento.plugins.store.addPoints({points: 50, reason: '完成任务奖励'});\nsetResult(result1);",
        "comment": "增加积分"
      },
      {
        "code": "// 扣除积分\nconst result2 = await Memento.plugins.store.addPoints({points: -20, reason: '购买道具'});\nsetResult(result2);",
        "comment": "扣除积分"
      }
    ],
    "notes": "会自动记录积分日志,包含类型(获得/消耗)、值、原因和时间",
    "enabled": true
  },
  "store_getRedeemHistory": {
    "title": "获取兑换历史",
    "description": "获取用户的所有兑换记录",
    "parameters": [],
    "returns": {
      "type": "Array",
      "description": "UserItem 对象数组"
    },
    "examples": [
      {
        "code": "const history = await Memento.plugins.store.getRedeemHistory({});\nsetResult(history);",
        "comment": "查询兑换记录"
      }
    ],
    "notes": "返回的 UserItem 包含: id, product_id, remaining, expire_date, purchase_date, purchase_price, product_snapshot(商品快照)",
    "enabled": true
  },
  "store_getPointsHistory": {
    "title": "获取积分历史",
    "description": "获取所有积分变动记录",
    "parameters": [],
    "returns": {
      "type": "Array",
      "description": "PointsLog 对象数组"
    },
    "examples": [
      {
        "code": "const logs = await Memento.plugins.store.getPointsHistory({});\nsetResult(logs);",
        "comment": "查询积分记录"
      }
    ],
    "notes": "返回的 PointsLog 包含: id, type(获得/消耗), value, reason, timestamp",
    "enabled": true
  },
  "store_getUserItems": {
    "title": "获取用户物品",
    "description": "获取用户拥有的所有物品",
    "parameters": [],
    "returns": {
      "type": "Array",
      "description": "UserItem 对象数组"
    },
    "examples": [
      {
        "code": "const items = await Memento.plugins.store.getUserItems({});\nsetResult(items);",
        "comment": "查询拥有的物品"
      }
    ],
    "notes": "仅返回未过期且剩余次数大于 0 的物品",
    "enabled": true
  },
  "store_useItem": {
    "title": "使用物品",
    "description": "使用用户物品,减少剩余次数",
    "parameters": [
      {
        "name": "itemId",
        "type": "String",
        "optional": false,
        "description": "物品 ID"
      }
    ],
    "returns": {
      "type": "Object",
      "description": "使用结果对象,包含 success, message"
    },
    "examples": [
      {
        "code": "const result = await Memento.plugins.store.useItem({itemId: '1731473170456'});\nconst msg = result.success ? '使用成功' : `使用失败: ${result.message}`;\nsetResult(msg);",
        "comment": "使用物品"
      }
    ],
    "notes": "使用后剩余次数减 1,次数归零后物品自动移除,过期物品无法使用。使用记录会保存到 used_items.json",
    "enabled": true
  },
  "store_archiveProduct": {
    "title": "归档商品",
    "description": "将商品移至归档列表(软删除)",
    "parameters": [
      {
        "name": "productId",
        "type": "String",
        "optional": false,
        "description": "商品 ID"
      }
    ],
    "returns": {
      "type": "Boolean",
      "description": "总是返回 true"
    },
    "examples": [
      {
        "code": "const result = await Memento.plugins.store.archiveProduct({productId: 'product123'});\nsetResult(result);",
        "comment": "归档商品"
      }
    ],
    "notes": "与 deleteProduct 功能相同,归档的商品可通过 restoreProduct 恢复",
    "enabled": true
  },
  "store_restoreProduct": {
    "title": "恢复商品",
    "description": "从归档列表恢复商品",
    "parameters": [
      {
        "name": "productId",
        "type": "String",
        "optional": false,
        "description": "归档商品 ID"
      }
    ],
    "returns": {
      "type": "Boolean",
      "description": "总是返回 true"
    },
    "examples": [
      {
        "code": "const result = await Memento.plugins.store.restoreProduct({productId: 'product123'});\nsetResult(result);",
        "comment": "恢复归档商品"
      }
    ],
    "notes": "如果归档商品不存在会抛出异常",
    "enabled": true
  },
  "store_getArchivedProducts": {
    "title": "获取归档商品",
    "description": "获取所有已归档的商品列表",
    "parameters": [],
    "returns": {
      "type": "Array",
      "description": "Product 对象数组"
    },
    "examples": [
      {
        "code": "const archived = await Memento.plugins.store.getArchivedProducts({});\nsetResult(archived);",
        "comment": "查询归档商品"
      }
    ],
    "notes": "归档商品不会在普通商品列表中显示",
    "enabled": true
  }
}
