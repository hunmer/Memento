<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Memento ç®€æ˜“æµ‹è¯•</title>
    <style>
        body {
            font-family: system-ui, sans-serif;
            background: #1e1e2e;
            color: #cdd6f4;
            padding: 20px;
            max-width: 600px;
            margin: 0 auto;
        }
        h1 { color: #89b4fa; text-align: center; }
        button {
            background: #89b4fa;
            color: #1e1e2e;
            border: none;
            padding: 12px 20px;
            margin: 5px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
        }
        button:hover { background: #b4befe; }
        #output {
            background: #11111b;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            white-space: pre-wrap;
            font-family: monospace;
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
        }
        .success { color: #a6e3a1; }
        .error { color: #f38ba8; }
        .info { color: #89dceb; }
    </style>
</head>
<body>
    <h1>Memento JS Bridge</h1>

    <div style="text-align: center;">
        <button onclick="testWebviewCards()">WebView å¡ç‰‡</button>
        <button onclick="testWebviewTabs()">WebView æ ‡ç­¾é¡µ</button>
        <button onclick="testDiary()">æ—¥è®°æ’ä»¶</button>
        <button onclick="testNotes()">ç¬”è®°æ’ä»¶</button>
        <button onclick="testActivity()">æ´»åŠ¨æ’ä»¶</button>
        <button onclick="testToast()">æ˜¾ç¤º Toast</button>
        <button onclick="testSystemTime()">ç³»ç»Ÿæ—¶é—´</button>
        <button onclick="clearLog()">æ¸…ç©º</button>
    </div>

    <div id="output"></div>

    <script>
        function log(msg, type = 'info') {
            const el = document.getElementById('output');
            const time = new Date().toLocaleTimeString();
            const text = typeof msg === 'object' ? JSON.stringify(msg, null, 2) : msg;
            el.innerHTML += `<span class="${type}">[${time}] ${text}</span>\n`;
            el.scrollTop = el.scrollHeight;
        }

        function clearLog() {
            document.getElementById('output').innerHTML = '';
        }

        async function call(fn) {
            try {
                if (!window.Memento) throw new Error('Memento Bridge æœªæ³¨å…¥');
                return await fn();
            } catch (e) {
                log('é”™è¯¯: ' + e.message, 'error');
                throw e;
            }
        }

        async function testWebviewCards() {
            log('è·å– WebView å¡ç‰‡...');
            try {
                const r = await call(() => Memento.plugins.webview.getCards());
                const data = typeof r === 'string' ? JSON.parse(r) : r;
                log(`æ‰¾åˆ° ${data.length || 0} å¼ å¡ç‰‡`, 'success');
                log(data);
            } catch (e) {}
        }

        async function testWebviewTabs() {
            log('è·å– WebView æ ‡ç­¾é¡µ...');
            try {
                const r = await call(() => Memento.plugins.webview.getTabs());
                const data = typeof r === 'string' ? JSON.parse(r) : r;
                log(`æ‰¾åˆ° ${data.length || 0} ä¸ªæ ‡ç­¾é¡µ`, 'success');
                log(data);
            } catch (e) {}
        }

        async function testDiary() {
            log('è·å–æ—¥è®°æ¡ç›®...');
            try {
                const r = await call(() => Memento.plugins.diary.getEntries({ limit: 5 }));
                const data = typeof r === 'string' ? JSON.parse(r) : r;
                log('æ—¥è®°æ•°æ®:', 'success');
                log(data);
            } catch (e) {}
        }

        async function testNotes() {
            log('è·å–ç¬”è®°...');
            try {
                const r = await call(() => Memento.plugins.notes.getNotes({}));
                const data = typeof r === 'string' ? JSON.parse(r) : r;
                log('ç¬”è®°æ•°æ®:', 'success');
                log(data);
            } catch (e) {}
        }

        async function testActivity() {
            log('è·å–æ´»åŠ¨è®°å½•...');
            try {
                const r = await call(() => Memento.plugins.activity.getActivities({ limit: 5 }));
                const data = typeof r === 'string' ? JSON.parse(r) : r;
                log('æ´»åŠ¨æ•°æ®:', 'success');
                log(data);
            } catch (e) {}
        }

        async function testToast() {
            log('æ˜¾ç¤º Toast...');
            try {
                await call(() => Memento.ui.toast('Hello from WebView! ğŸ‰'));
                log('Toast å·²æ˜¾ç¤º', 'success');
            } catch (e) {}
        }

        async function testSystemTime() {
            log('è·å–ç³»ç»Ÿæ—¶é—´...');
            try {
                const r = await call(() => Memento.system.getCurrentTime());
                log('ç³»ç»Ÿæ—¶é—´: ' + JSON.stringify(r), 'success');
            } catch (e) {}
        }

        // åˆå§‹åŒ–
        window.onload = () => {
            log('æµ‹è¯•é¡µé¢å·²åŠ è½½', 'info');
            setTimeout(() => {
                if (window.Memento) {
                    log('Memento Bridge å·²è¿æ¥', 'success');
                } else {
                    log('è¯·åœ¨ Memento WebView ä¸­æ‰“å¼€æ­¤é¡µé¢', 'error');
                }
            }, 500);
        };
    </script>
</body>
</html>
