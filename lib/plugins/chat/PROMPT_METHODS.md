# Chat æ’ä»¶ Prompt æ›¿æ¢æ–¹æ³•ä½¿ç”¨æŒ‡å—

æœ¬æ–‡æ¡£è¯´æ˜å¦‚ä½•åœ¨ OpenAI æ’ä»¶çš„ Prompt ä¸­ä½¿ç”¨ Chat æ’ä»¶æä¾›çš„æ•°æ®åˆ†ææ–¹æ³•ã€‚

## å¯ç”¨æ–¹æ³•

### 1. chat_getMessages - è·å–æ¶ˆæ¯åˆ—è¡¨

è·å–æŒ‡å®šé¢‘é“å’Œæ—¥æœŸèŒƒå›´å†…çš„æ¶ˆæ¯æ•°æ®ã€‚

**å‚æ•°ï¼š**
- `channelId` (å¯é€‰): é¢‘é“IDï¼Œç•™ç©ºåˆ™è·å–æ‰€æœ‰é¢‘é“çš„æ¶ˆæ¯
- `startDate` (å¯é€‰): å¼€å§‹æ—¥æœŸï¼Œæ ¼å¼ YYYY-MM-DDï¼Œé»˜è®¤ä»Šå¤©
- `endDate` (å¯é€‰): ç»“æŸæ—¥æœŸï¼Œæ ¼å¼ YYYY-MM-DDï¼Œé»˜è®¤ä»Šå¤©
- `mode` (å¯é€‰): æ•°æ®æ¨¡å¼ï¼Œå¯é€‰å€¼ï¼šsummaryï¼ˆé»˜è®¤ï¼‰ã€compactã€full

**ä½¿ç”¨ç¤ºä¾‹ï¼š**

```
# è·å–ä»Šå¤©æ‰€æœ‰é¢‘é“çš„æ¶ˆæ¯æ‘˜è¦
{{chat_getMessages(mode: "summary")}}

# è·å–ç‰¹å®šé¢‘é“çš„æ¶ˆæ¯åˆ—è¡¨ï¼ˆç´§å‡‘æ¨¡å¼ï¼‰
{{chat_getMessages(channelId: "channel123", mode: "compact")}}

# è·å–æ—¥æœŸèŒƒå›´å†…çš„å®Œæ•´æ¶ˆæ¯æ•°æ®
{{chat_getMessages(startDate: "2025-01-01", endDate: "2025-01-31", mode: "full")}}

# è·å–ç‰¹å®šé¢‘é“å’Œæ—¥æœŸèŒƒå›´çš„æ¶ˆæ¯
{{chat_getMessages(channelId: "channel123", startDate: "2025-01-15", endDate: "2025-01-20", mode: "compact")}}
```

**è¿”å›æ ¼å¼ï¼š**

- **summary æ¨¡å¼**ï¼ˆä»…ç»Ÿè®¡ï¼‰ï¼š
```json
{
  "sum": {
    "total": 100,
    "totalChannels": 3,
    "avgPerChannel": 33
  }
}
```

- **compact æ¨¡å¼**ï¼ˆç®€åŒ–è®°å½•ï¼Œæ—  contentï¼‰ï¼š
```json
{
  "sum": { "total": 10 },
  "recs": [
    {
      "id": "msg123",
      "channelId": "channel1",
      "type": "sent",
      "ts": "2025-01-15T09:00:00.000Z",
      "user": { "id": "user1" },
      "edited": "2025-01-15T10:00:00.000Z",
      "replyTo": "msg122",
      "fixed": "ğŸ“Œ"
    }
  ]
}
```

- **full æ¨¡å¼**ï¼ˆå®Œæ•´æ•°æ®ï¼‰ï¼š
```json
{
  "recs": [
    {
      "id": "msg123",
      "channelId": "channel1",
      "content": "æ¶ˆæ¯å†…å®¹...",
      "type": "sent",
      "date": "2025-01-15T09:00:00.000Z",
      "user": { "id": "user1" },
      "editedAt": "2025-01-15T10:00:00.000Z",
      "fixedSymbol": "ğŸ“Œ",
      "bubbleColor": "#FF5722",
      "metadata": {},
      "replyToId": "msg122"
    }
  ]
}
```

---

### 2. chat_getChannels - è·å–é¢‘é“åˆ—è¡¨

è·å–æ‰€æœ‰èŠå¤©é¢‘é“çš„ä¿¡æ¯ã€‚

**å‚æ•°ï¼š**
- `mode` (å¯é€‰): æ•°æ®æ¨¡å¼ï¼Œå¯é€‰å€¼ï¼šsummaryï¼ˆé»˜è®¤ï¼‰ã€compactã€full

**ä½¿ç”¨ç¤ºä¾‹ï¼š**

```
# è·å–é¢‘é“ç»Ÿè®¡æ‘˜è¦
{{chat_getChannels(mode: "summary")}}

# è·å–é¢‘é“åˆ—è¡¨ï¼ˆç´§å‡‘æ¨¡å¼ï¼‰
{{chat_getChannels(mode: "compact")}}

# è·å–å®Œæ•´é¢‘é“æ•°æ®
{{chat_getChannels(mode: "full")}}
```

**è¿”å›æ ¼å¼ï¼š**

- **summary æ¨¡å¼**ï¼š
```json
{
  "sum": {
    "total": 5,
    "totalMessages": 1234
  }
}
```

- **compact æ¨¡å¼**ï¼š
```json
{
  "sum": {
    "total": 5,
    "totalMessages": 1234
  },
  "recs": [
    {
      "id": "channel1",
      "title": "å·¥ä½œç¾¤",
      "msgCnt": 456,
      "priority": 1,
      "groups": ["å·¥ä½œ", "é‡è¦"]
    }
  ]
}
```

- **full æ¨¡å¼**ï¼š
```json
{
  "recs": [
    {
      "id": "channel1",
      "title": "å·¥ä½œç¾¤",
      "draft": "è‰ç¨¿å†…å®¹...",
      "icon": 59574,
      "iconFontFamily": "MaterialIcons",
      "backgroundColor": "#2196F3",
      "priority": 1,
      "groups": ["å·¥ä½œ", "é‡è¦"],
      "fixedSymbol": "â­",
      "backgroundPath": "./backgrounds/bg1.jpg",
      "lastMessageTime": "2025-01-15T12:00:00.000Z",
      "metadata": {}
    }
  ]
}
```

---

### 3. chat_getStatistics - è·å–æ¶ˆæ¯ç»Ÿè®¡

è·å–æ¶ˆæ¯çš„ç»Ÿè®¡åˆ†ææ•°æ®ã€‚

**å‚æ•°ï¼š**
- `channelId` (å¯é€‰): é¢‘é“IDï¼Œç•™ç©ºåˆ™ç»Ÿè®¡æ‰€æœ‰é¢‘é“
- `startDate` (å¯é€‰): å¼€å§‹æ—¥æœŸï¼Œæ ¼å¼ YYYY-MM-DD
- `endDate` (å¯é€‰): ç»“æŸæ—¥æœŸï¼Œæ ¼å¼ YYYY-MM-DD

**ä½¿ç”¨ç¤ºä¾‹ï¼š**

```
# è·å–ä»Šå¤©æ‰€æœ‰é¢‘é“çš„æ¶ˆæ¯ç»Ÿè®¡
{{chat_getStatistics()}}

# è·å–ç‰¹å®šé¢‘é“çš„ç»Ÿè®¡
{{chat_getStatistics(channelId: "channel123")}}

# è·å–æ—¥æœŸèŒƒå›´å†…çš„ç»Ÿè®¡
{{chat_getStatistics(startDate: "2025-01-01", endDate: "2025-01-31")}}

# è·å–ç‰¹å®šé¢‘é“å’Œæ—¥æœŸèŒƒå›´çš„ç»Ÿè®¡
{{chat_getStatistics(channelId: "channel123", startDate: "2025-01-15", endDate: "2025-01-20")}}
```

**è¿”å›æ ¼å¼ï¼š**

```json
{
  "sum": {
    "total": 100,
    "byType": {
      "sent": 60,
      "received": 30,
      "file": 5,
      "image": 3,
      "audio": 2
    },
    "byChannel": {
      "channel1": 50,
      "channel2": 30,
      "channel3": 20
    }
  }
}
```

---

## ä½¿ç”¨åœºæ™¯ç¤ºä¾‹

### åœºæ™¯ 1ï¼šåˆ†æèŠå¤©æ´»è·ƒåº¦

```
è¯·åˆ†ææˆ‘åœ¨ {{chat_getStatistics(startDate: "2025-01-01", endDate: "2025-01-31")}} æœŸé—´çš„èŠå¤©æ´»è·ƒåº¦ï¼Œæ€»ç»“ï¼š
1. å“ªä¸ªé¢‘é“æœ€æ´»è·ƒ
2. æ¯å¤©å¹³å‡å‘é€å¤šå°‘æ¡æ¶ˆæ¯
3. æ¶ˆæ¯ç±»å‹åˆ†å¸ƒ
```

### åœºæ™¯ 2ï¼šæŸ¥æ‰¾ç‰¹å®šå†…å®¹

```
ä»¥ä¸‹æ˜¯æˆ‘æœ€è¿‘çš„æ¶ˆæ¯è®°å½•ï¼š
{{chat_getMessages(startDate: "2025-01-10", endDate: "2025-01-15", mode: "full")}}

è¯·å¸®æˆ‘æ‰¾å‡ºæ‰€æœ‰å…³äº"é¡¹ç›®è¿›åº¦"çš„è®¨è®ºã€‚
```

### åœºæ™¯ 3ï¼šé¢‘é“ç®¡ç†å»ºè®®

```
æ ¹æ®æˆ‘çš„é¢‘é“ä½¿ç”¨æƒ…å†µï¼š
{{chat_getChannels(mode: "compact")}}

è¯·ç»™æˆ‘ä¸€äº›é¢‘é“ç®¡ç†å»ºè®®ï¼Œæ¯”å¦‚å“ªäº›é¢‘é“å¯ä»¥å½’æ¡£æˆ–åˆå¹¶ã€‚
```

### åœºæ™¯ 4ï¼šè·¨é¢‘é“æ¶ˆæ¯æ±‡æ€»

```
è¯·æ±‡æ€»ä»¥ä¸‹æ‰€æœ‰é¢‘é“ä¸­å…³äº"ä¼šè®®"çš„æ¶ˆæ¯ï¼š
{{chat_getMessages(mode: "compact")}}

åˆ—å‡ºæ‰€æœ‰åŒ…å«"ä¼šè®®"å…³é”®è¯çš„æ¶ˆæ¯ï¼Œå¹¶æŒ‰æ—¶é—´æ’åºã€‚
```

---

## æ•°æ®æ¨¡å¼é€‰æ‹©å»ºè®®

| æ¨¡å¼ | Token æ¶ˆè€— | é€‚ç”¨åœºæ™¯ |
|------|-----------|---------|
| **summary** | æœ€å°‘ (~200 tokens) | åªéœ€è¦ç»Ÿè®¡æ•°æ®ï¼Œä¸éœ€è¦å…·ä½“å†…å®¹ |
| **compact** | ä¸­ç­‰ (~1000 tokens) | éœ€è¦æŸ¥çœ‹æ¶ˆæ¯åˆ—è¡¨ï¼Œä½†ä¸éœ€è¦å®Œæ•´å†…å®¹ |
| **full** | æœ€å¤š (~5000+ tokens) | éœ€è¦å®Œæ•´æ•°æ®è¿›è¡Œè¯¦ç»†åˆ†æ |

**å»ºè®®ï¼š**
1. ä¼˜å…ˆä½¿ç”¨ `summary` æ¨¡å¼è·å–æ¦‚è§ˆ
2. å¦‚éœ€è¯¦ç»†åˆ†æï¼Œå†ä½¿ç”¨ `compact` æˆ– `full` æ¨¡å¼
3. å¯¹äºå¤§é‡æ•°æ®ï¼Œè€ƒè™‘ç¼©å°æ—¥æœŸèŒƒå›´æˆ–æŒ‡å®šé¢‘é“ID

---

## é”™è¯¯å¤„ç†

å¦‚æœæ–¹æ³•æ‰§è¡Œå¤±è´¥ï¼Œä¼šè¿”å›åŒ…å«é”™è¯¯ä¿¡æ¯çš„ JSONï¼š

```json
{
  "error": "è·å–æ¶ˆæ¯æ•°æ®æ—¶å‡ºé”™",
  "details": "å…·ä½“é”™è¯¯ä¿¡æ¯..."
}
```

---

## æ³¨æ„äº‹é¡¹

1. **æ—¥æœŸæ ¼å¼**ï¼šæ”¯æŒ `YYYY-MM-DD` å’Œ `YYYY/MM/DD` æ ¼å¼
2. **é»˜è®¤æ—¥æœŸ**ï¼šä¸æä¾›æ—¥æœŸå‚æ•°æ—¶ï¼Œé»˜è®¤ä¸ºå½“å¤©
3. **é¢‘é“ID**ï¼šå¯é€šè¿‡ `chat_getChannels` æ–¹æ³•æŸ¥çœ‹æ‰€æœ‰å¯ç”¨çš„é¢‘é“ID
4. **æ€§èƒ½è€ƒè™‘**ï¼šæŸ¥è¯¢å¤§é‡æ•°æ®æ—¶å»ºè®®ä½¿ç”¨ `summary` æˆ– `compact` æ¨¡å¼

---

## ç‰ˆæœ¬ä¿¡æ¯

- **åˆ›å»ºæ—¥æœŸ**: 2025-11-15
- **éµå¾ªè§„èŒƒ**: Memento Prompt æ•°æ®æ ¼å¼è§„èŒƒ v2.0
- **ä¾èµ–æ’ä»¶**: Chat Plugin v1.0, OpenAI Plugin v1.0
